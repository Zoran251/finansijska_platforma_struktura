<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINALNI TEST - Sinhronizacija Bud≈æeta</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .button {
            background: #D4AF37;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #C5A028;
        }
        .data-display {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .warning { background: #f59e0b; }
        .info { background: #3b82f6; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .budget-card {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #555;
        }
        .budget-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #D4AF37;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ FINALNI TEST - Potpuna Sinhronizacija Bud≈æeta</h1>
        
        <div class="section">
            <h2>üîß Kontrola i Setup</h2>
            <button class="button" onclick="clearAllData()">üóëÔ∏è Obri≈°i sve podatke</button>
            <button class="button" onclick="createTestBudget()">üí∞ Kreiraj test bud≈æet</button>
            <button class="button" onclick="checkAllData()">üîç Proveri sve podatke</button>
            <button class="button" onclick="testSyncFunctions()">üîÑ Test sinhronizacije</button>
            <div id="controlStatus" class="status"></div>
        </div>
        
        <div class="section">
            <h2>üìä Trenutno stanje localStorage</h2>
            <div id="localStorageDisplay" class="data-display"></div>
        </div>
        
        <div class="grid">
            <div class="section">
                <h2>üíº Simulacija Profil Prikaza</h2>
                <div class="budget-card">
                    <div>Meseƒçni prihod:</div>
                    <div id="profileIncome" class="budget-value">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>Tro≈°kovi (Glavne potrebe + Hobi):</div>
                    <div id="profileExpenses" class="budget-value">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>≈†tednja:</div>
                    <div id="profileSavings" class="budget-value">‚Ç¨0</div>
                </div>
                <button class="button" onclick="updateProfileDisplay()">üîÑ A≈æuriraj profil prikaz</button>
            </div>
            
            <div class="section">
                <h2>üìà Simulacija Dashboard Prikaza</h2>
                <div class="budget-card">
                    <div>Ukupni prihodi:</div>
                    <div id="dashboardIncome" class="budget-value" data-budget="total-income">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>Ukupni rashodi:</div>
                    <div id="dashboardExpenses" class="budget-value" data-budget="total-expenses">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>Neto bilans:</div>
                    <div id="dashboardSavings" class="budget-value" data-budget="net-savings">‚Ç¨0</div>
                </div>
                <button class="button" onclick="updateDashboardDisplay()">üîÑ A≈æuriraj dashboard prikaz</button>
            </div>
        </div>
        
        <div class="section">
            <h2>üìã Simulacija Preview Prikaza</h2>
            <div class="grid">
                <div class="budget-card">
                    <div>Prihod:</div>
                    <div id="previewIncome" class="budget-value">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>Tro≈°kovi:</div>
                    <div id="previewExpenses" class="budget-value">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>≈†tednja:</div>
                    <div id="previewSavings" class="budget-value">‚Ç¨0</div>
                </div>
                <div class="budget-card">
                    <div>Preostalo:</div>
                    <div id="previewRemaining" class="budget-value">‚Ç¨0</div>
                </div>
            </div>
            <button class="button" onclick="updatePreviewDisplay()">üîÑ A≈æuriraj preview prikaz</button>
        </div>
        
        <div class="section">
            <h2>üéØ GLAVNI TEST SINHRONIZACIJE</h2>
            <button class="button" onclick="runMainSyncTest()">üöÄ Pokreni glavni test</button>
            <div id="mainTestStatus" class="status"></div>
        </div>
        
        <div class="section">
            <h2>üìù Log aktivnosti</h2>
            <div id="activityLog" class="data-display"></div>
            <button class="button" onclick="clearLog()">üßπ Obri≈°i log</button>
        </div>
    </div>

    <script>
        let activityLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            activityLog.push(logEntry);
            updateLogDisplay();
            console.log(logEntry);
        }
        
        function updateLogDisplay() {
            document.getElementById('activityLog').textContent = activityLog.slice(-20).join('\n');
        }
        
        function clearLog() {
            activityLog = [];
            updateLogDisplay();
        }
        
        function clearAllData() {
            localStorage.removeItem('userBudget');
            localStorage.removeItem('budget');
            localStorage.removeItem('budgetData');
            
            const statusDiv = document.getElementById('controlStatus');
            statusDiv.className = 'status warning';
            statusDiv.textContent = 'üóëÔ∏è Svi podatci obrisani iz localStorage';
            
            log('Svi localStorage podatci obrisani', 'warning');
            checkAllData();
        }
        
        function createTestBudget() {
            const testBudget = {
                monthlyIncome: 75000,
                necessities: 50,     // 37,500 RSD
                hobby: 30,          // 22,500 RSD
                savings: 20,        // 15,000 RSD
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('userBudget', JSON.stringify(testBudget));
            
            const statusDiv = document.getElementById('controlStatus');
            statusDiv.className = 'status success';
            statusDiv.innerHTML = `
                ‚úÖ Test bud≈æet kreiran!<br>
                üí∞ Prihod: ${testBudget.monthlyIncome.toLocaleString()} RSD<br>
                üìä Podela: ${testBudget.necessities}% | ${testBudget.hobby}% | ${testBudget.savings}%
            `;
            
            log(`Test bud≈æet kreiran: ${testBudget.monthlyIncome} RSD`, 'success');
            checkAllData();
        }
        
        function checkAllData() {
            const userBudget = localStorage.getItem('userBudget');
            const budget = localStorage.getItem('budget');
            const budgetData = localStorage.getItem('budgetData');
            
            let displayText = 'TRENUTNO STANJE:\n\n';
            
            if (userBudget) {
                try {
                    const parsed = JSON.parse(userBudget);
                    displayText += 'userBudget (PROFIL FORMAT):\n' + JSON.stringify(parsed, null, 2) + '\n\n';
                } catch (e) {
                    displayText += 'userBudget: NEISPRAVNA JSON\n\n';
                }
            } else {
                displayText += 'userBudget: NULL\n\n';
            }
            
            if (budget) {
                try {
                    const parsed = JSON.parse(budget);
                    displayText += 'budget (MAIN FORMAT):\n' + JSON.stringify(parsed, null, 2) + '\n\n';
                } catch (e) {
                    displayText += 'budget: NEISPRAVNA JSON\n\n';
                }
            } else {
                displayText += 'budget: NULL\n\n';
            }
            
            if (budgetData) {
                displayText += 'budgetData: ' + budgetData + '\n\n';
            } else {
                displayText += 'budgetData: NULL\n\n';
            }
            
            document.getElementById('localStorageDisplay').textContent = displayText;
        }
        
        function testSyncFunctions() {
            const statusDiv = document.getElementById('controlStatus');
            
            if (typeof window.BudgetSync !== 'undefined') {
                log('BudgetSync DOSTUPAN - testiram funkcije', 'success');
                
                try {
                    const unifiedData = window.BudgetSync.getUnifiedBudgetData();
                    if (unifiedData) {
                        statusDiv.className = 'status success';
                        statusDiv.innerHTML = `
                            ‚úÖ BudgetSync funkcije rade!<br>
                            üìä Izvor: ${unifiedData.source}<br>
                            üí∞ Prihod: ${unifiedData.monthlyIncome.toLocaleString()} RSD<br>
                            üí∏ Tro≈°kovi: ${unifiedData.totalExpenses.toLocaleString()} RSD<br>
                            üí∞ ≈†tednja: ${unifiedData.netSavings.toLocaleString()} RSD
                        `;
                        log(`BudgetSync radi: prihod=${unifiedData.monthlyIncome}, tro≈°kovi=${unifiedData.totalExpenses}`, 'success');
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = '‚ùå BudgetSync ne mo≈æe da uƒçita podatke';
                        log('BudgetSync ne mo≈æe da uƒçita podatke', 'error');
                    }
                } catch (error) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå Gre≈°ka u BudgetSync: ' + error.message;
                    log('Gre≈°ka u BudgetSync: ' + error.message, 'error');
                }
            } else {
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå BudgetSync NIJE DOSTUPAN';
                log('BudgetSync NIJE DOSTUPAN', 'error');
            }
        }
        
        function updateProfileDisplay() {
            try {
                if (typeof window.BudgetSync !== 'undefined') {
                    const data = window.BudgetSync.getUnifiedBudgetData();
                    if (data) {
                        document.getElementById('profileIncome').textContent = `‚Ç¨${data.monthlyIncome.toLocaleString()}`;
                        document.getElementById('profileExpenses').textContent = `‚Ç¨${data.totalExpenses.toLocaleString()}`;
                        document.getElementById('profileSavings').textContent = `‚Ç¨${data.netSavings.toLocaleString()}`;
                        log('Profil prikaz a≈æuriran', 'success');
                    }
                } else {
                    log('BudgetSync nije dostupan za profil', 'error');
                }
            } catch (error) {
                log('Gre≈°ka pri a≈æuriranju profila: ' + error.message, 'error');
            }
        }
        
        function updateDashboardDisplay() {
            try {
                if (typeof window.BudgetSync !== 'undefined') {
                    const data = window.BudgetSync.getUnifiedBudgetData();
                    if (data) {
                        window.BudgetSync.updateDashboardDisplay(data);
                        
                        // A≈æuriraj i na≈°e test elemente
                        document.getElementById('dashboardIncome').textContent = `‚Ç¨${data.monthlyIncome.toLocaleString()}`;
                        document.getElementById('dashboardExpenses').textContent = `‚Ç¨${data.totalExpenses.toLocaleString()}`;
                        document.getElementById('dashboardSavings').textContent = `‚Ç¨${data.netSavings.toLocaleString()}`;
                        log('Dashboard prikaz a≈æuriran', 'success');
                    }
                } else {
                    log('BudgetSync nije dostupan za dashboard', 'error');
                }
            } catch (error) {
                log('Gre≈°ka pri a≈æuriranju dashboard-a: ' + error.message, 'error');
            }
        }
        
        function updatePreviewDisplay() {
            try {
                if (typeof window.BudgetSync !== 'undefined') {
                    const data = window.BudgetSync.getUnifiedBudgetData();
                    if (data) {
                        window.BudgetSync.updatePreviewDisplay(data);
                        
                        // A≈æuriraj i na≈°e test elemente
                        document.getElementById('previewIncome').textContent = `‚Ç¨${data.monthlyIncome.toLocaleString()}`;
                        document.getElementById('previewExpenses').textContent = `‚Ç¨${data.totalExpenses.toLocaleString()}`;
                        document.getElementById('previewSavings').textContent = `‚Ç¨${data.netSavings.toLocaleString()}`;
                        document.getElementById('previewRemaining').textContent = `‚Ç¨${data.remainingBalance.toLocaleString()}`;
                        log('Preview prikaz a≈æuriran', 'success');
                    }
                } else {
                    log('BudgetSync nije dostupan za preview', 'error');
                }
            } catch (error) {
                log('Gre≈°ka pri a≈æuriranju preview-a: ' + error.message, 'error');
            }
        }
        
        function runMainSyncTest() {
            const statusDiv = document.getElementById('mainTestStatus');
            statusDiv.className = 'status info';
            statusDiv.textContent = 'üîÑ Pokreƒáem glavni test sinhronizacije...';
            
            log('POƒåETAK GLAVNOG TESTA SINHRONIZACIJE', 'info');
            
            // Korak 1: Kreiraj test podatke
            createTestBudget();
            
            // Korak 2: Proveri da li BudgetSync postoji
            setTimeout(() => {
                if (typeof window.BudgetSync !== 'undefined') {
                    log('‚úÖ BudgetSync je dostupan', 'success');
                    
                    // Korak 3: Test ƒçitanja podataka
                    const data = window.BudgetSync.getUnifiedBudgetData();
                    if (data) {
                        log(`‚úÖ Podatci uspe≈°no uƒçitani: ${data.source} format`, 'success');
                        
                        // Korak 4: Test sinhronizacije svih prikaza
                        const syncResult = window.BudgetSync.synchronizeAllDisplays();
                        if (syncResult) {
                            log('‚úÖ Sinhronizacija svih prikaza uspe≈°na', 'success');
                            
                            // Korak 5: A≈æuriraj na≈°e test prikaze
                            updateProfileDisplay();
                            updateDashboardDisplay();
                            updatePreviewDisplay();
                            
                            statusDiv.className = 'status success';
                            statusDiv.innerHTML = `
                                üéâ GLAVNI TEST USPE≈†AN!<br>
                                ‚úÖ BudgetSync radi<br>
                                ‚úÖ Podatci se ƒçitaju<br>
                                ‚úÖ Sinhronizacija funkcioni≈°e<br>
                                ‚úÖ Svi prikazi a≈æurirani
                            `;
                            log('üéâ GLAVNI TEST ZAVR≈†EN USPE≈†NO', 'success');
                        } else {
                            statusDiv.className = 'status error';
                            statusDiv.textContent = '‚ùå Sinhronizacija neuspe≈°na';
                            log('‚ùå Sinhronizacija neuspe≈°na', 'error');
                        }
                    } else {
                        statusDiv.className = 'status error';
                        statusDiv.textContent = '‚ùå Ne mogu da uƒçitam podatke';
                        log('‚ùå Ne mogu da uƒçitam podatke', 'error');
                    }
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = '‚ùå BudgetSync nije dostupan';
                    log('‚ùå BudgetSync nije dostupan', 'error');
                }
            }, 1000);
        }
        
        // Automatski proveri podatke pri uƒçitavanju
        window.onload = function() {
            log('Test stranica uƒçitana', 'info');
            checkAllData();
            
            // Proveravaj BudgetSync na svakih 2 sekunde
            const checkInterval = setInterval(() => {
                if (typeof window.BudgetSync !== 'undefined') {
                    log('BudgetSync je sada dostupan!', 'success');
                    clearInterval(checkInterval);
                }
            }, 2000);
        };
    </script>
    
    <!-- Uƒçitaj main.js da bi imao BudgetSync -->
    <script src="js/main.js"></script>
</body>
</html>
