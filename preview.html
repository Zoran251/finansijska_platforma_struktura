<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Balance | Finansijska platforma</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            /* Enhanced Gold Palette */
            --gold-bright: #FFD700; /* Svetlija zlatna */
            --gold-medium: #D4AF37; /* Osnovna zlatna */
            --gold-dark: #B8860B; /* Tamnija zlatna */
            --gold-pale: #F0E68C; /* Bleda zlatna */
            --gold-glow: rgba(255, 215, 0, 0.3); /* Zlatni sjaj za efekte */
            
            /* Gradijenti */
            --gradient-gold: linear-gradient(135deg, #FFD700, #D4AF37, #B8860B);
            --gradient-gold-light: linear-gradient(135deg, #F0E68C, #FFD700);
            --gradient-gold-dark: linear-gradient(135deg, #B8860B, #8B6914);
            
            /* Tamna paleta */
            --dark-bg: #0A0A0A; /* Tamnija pozadina */
            --dark-card: #121212; /* Tamnija kartica */
            --dark-accent: #1E1E1E; /* Tamni akcent */
            
            /* Tekst */
            --light-text: #FFFFFF; /* Čist beli tekst za bolji kontrast */
            --muted-text: #CCCCCC; /* Svetliji sivi za bolju čitljivost */
            
            /* Dodatni efekti */
            --border-light: rgba(212, 175, 55, 0.3);
            --glass-effect: rgba(255, 215, 0, 0.05);
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 6px 20px rgba(0, 0, 0, 0.2);
            --box-shadow-hover: 0 8px 30px rgba(255, 215, 0, 0.15);
            
            /* Dimenzije i razmaci */
            --border-radius: 0.75rem;
            --border-radius-lg: 1.25rem;
            --spacing-xs: 0.5rem;
            --spacing-sm: 0.75rem;
            --spacing-md: 1.25rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
            
            /* Tranzicije */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--light-text);
            line-height: 1.7;
            background: var(--dark-bg);
            background-image: 
                radial-gradient(at 20% 20%, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
                radial-gradient(at 80% 80%, rgba(184, 134, 11, 0.05) 0%, transparent 40%);
            position: relative;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Modern Background Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.03) 0%, transparent 30%),
                radial-gradient(circle at 80% 70%, rgba(184, 134, 11, 0.03) 0%, transparent 30%);
            pointer-events: none;
            z-index: -1;
        }

        /* Enhanced background animation */
        @keyframes backgroundAnimation {
            0% {
                transform: scale(1) rotate(0deg);
                opacity: 0.1;
            }
            50% {
                opacity: 0.15;
            }
            100% {
                transform: scale(1.1) rotate(5deg);
                opacity: 0.1;
            }
        }
        
        @keyframes backgroundAnimation {
            0% {
                transform: rotate(0deg) scale(1);
            }
            100% {
                transform: rotate(5deg) scale(1.1);
            }
        }
        
        @keyframes morph {
            0% {
                border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            }
            25% { 
                border-radius: 58% 42% 75% 25% / 76% 46% 54% 24%;
            }
            50% {
                border-radius: 50% 50% 33% 67% / 55% 27% 73% 45%;
            }
            75% {
                border-radius: 33% 67% 58% 42% / 63% 68% 32% 37%;
            }
            100% {
                border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            }
        }

        .container {
            background: rgba(16, 16, 18, 0.3);
            border-radius: var(--border-radius-lg);
            margin: 2rem auto;
            padding: 2.5rem;
            width: 90%;
            max-width: 1200px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
            backdrop-filter: blur(10px);
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.03), transparent);
            pointer-events: none;
        }

        .chart-container {
            background: rgba(25, 25, 25, 0.98);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            margin-top: var(--spacing-xl);
            border: 1px solid rgba(212, 175, 55, 0.15);
        }

        .section-card {
            background: var(--dark-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            transform: translateY(0);
        }
        
        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .section-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, transparent, var(--glass-effect));
            border-radius: 0 0 0 100%;
            pointer-events: none;
            opacity: 0.5;
        }

        /* Navigation Header */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 2rem;
            background: rgba(10, 10, 12, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(212, 175, 55, 0.15);
        }

        .brand {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #f8f8f8;
            text-decoration: none;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .logo img {
            height: 40px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }
        
        .logo:hover img {
            filter: drop-shadow(0 0 15px rgba(212, 175, 55, 0.5));
        }

        .brand i {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #2563eb, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        button, .button {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            background: var(--gradient-gold);
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            z-index: 1;
            letter-spacing: 0.5px;
        }
        
        button:hover, .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.1);
        }
        
        button:active, .button:active {
            transform: translateY(0);
        }
        
        button::before, .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,0.2), rgba(255,255,255,0));
            transform: translateX(-100%);
            transition: transform 0.6s ease;
            z-index: -1;
        }
        
        button:hover::before, .button:hover::before {
            transform: translateX(100%);
        }

        .ai-chat-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: white;
            padding: 0.5rem 1.2rem;
            border: none;
            border-radius: 2rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            text-decoration: none;
            white-space: nowrap;
        }

        .ai-chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .ai-chat-button i {
            font-size: 1.2rem;
        }

        /* AI Chat Interface */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 320px;
            height: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            transform: translateY(120%);
            transition: transform 0.3s ease;
        }

        .chat-container.active {
            transform: translateY(0);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(45deg, #2563eb, #059669);
            color: white;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .bot-message {
            align-self: flex-start;
            background: #f0f0f0;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(45deg, #2563eb, #059669);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }

        .chat-input input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
        }

        .send-button {
            background: linear-gradient(45deg, #2563eb, #059669);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-group {
            background: rgba(255, 255, 255, 0.9);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            max-width: 500px;
        }

        /* Background pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.1) 0%, transparent 50%);
        }

        /* Hero section enhancement */
        .hero-section {
            background: linear-gradient(135deg, #f8fafc 0%, #f0f9ff 100%);
            padding: var(--spacing-xl) 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(184, 134, 11, 0.05) 0%, transparent 40%);
            z-index: -1;
            opacity: 0.8;
        }

        .hero-title {
            font-size: 3.75rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            background: linear-gradient(45deg, #FFD700, #D4AF37, #B8860B);
            -webkit-background-clip: text;
            -moz-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.2);
            letter-spacing: -0.02em;
            line-height: 1.2;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-description {
            font-size: 1.25rem;
            color: var(--muted-text);
            margin-bottom: var(--spacing-xl);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            padding: var(--spacing-md);
            background: rgba(30, 30, 30, 0.7);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
            border: 1px solid rgba(255, 215, 0, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            line-height: 1.7;
        }

        .button-group {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            justify-content: center;
            margin-top: var(--spacing-xl);
        }

        .primary-button {
            padding: 1rem 2.5rem;
            background: linear-gradient(45deg, #FFD700, #D4AF37);
            color: #1a1a1a;
            border: none;
            font-weight: 600;
            border-radius: 50px;
            position: relative;
            overflow: hidden;
            z-index: 1;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.2);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.1);
        }

        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(212, 175, 55, 0.2), 0 3px 6px rgba(212, 175, 55, 0.15);
            background: linear-gradient(45deg, #FFC107, #D4AF37);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.2);
        }
        
        .submit-button {
            background: linear-gradient(45deg, #2563eb, #059669);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
            width: 100%;
            margin-top: var(--spacing-md);
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(37, 99, 235, 0.3);
        }
        
        .submit-button i {
            font-size: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            max-width: 600px;
            margin: 2rem auto;
            position: relative;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-top: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .hero-section {
            padding: var(--spacing-xl) 0;
            text-align: center;
            max-width: 1200px;
            margin: 0 auto;
            color: #fff;
            background: linear-gradient(135deg, #0a0a0c 0%, #1a1a1f 100%);
            border-radius: 16px;
            padding: 3rem 2rem;
            margin: 2rem auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 215, 0, 0.15);
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: var(--spacing-md);
            background: linear-gradient(45deg, #ffd700, #d4af37);
            background-clip: text;
            -webkit-background-clip: text;
            -moz-background-clip: text;
            -o-background-clip: text;
            -webkit-text-fill-color: transparent;
            -moz-text-fill-color: transparent;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hero-description {
            font-size: 1.25rem;
            color: #d4d4d8;
            margin-bottom: var(--spacing-xl);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            padding: 0 1rem;
            perspective: 1000px;
        }
        
        .feature-card {
            background: linear-gradient(145deg, #1e1e24, #2a2a32);
            border-radius: 1rem;
            padding: 2rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            text-align: left;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2), 0 6px 6px rgba(0, 0, 0, 0.23), inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transform-style: preserve-3d;
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #d4af37, #f1c40f, #d4af37);
            transform: translateY(-4px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .feature-card:hover {
            transform: translateY(-8px) rotateX(5deg) rotateY(5deg);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3), 0 12px 12px rgba(0, 0, 0, 0.25);
            border-color: rgba(212, 175, 55, 0.4);
            -webkit-background-clip: padding-box;
            background-clip: padding-box;
        }
        
        .feature-card:hover::before {
            transform: translateY(0);
        }
        
        .feature-card i {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #d4af37, #f1c40f);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 1.5rem;
            display: inline-block;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .feature-card h3 {
            color: #f8f8f8;
            margin-bottom: 1rem;
            font-size: 1.4rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .feature-card p {
            color: #a1a1aa;
            font-size: 1rem;
            line-height: 1.7;
            margin: 0;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .button-group {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            justify-content: center;
            margin-top: var(--spacing-xl);
        }

        .primary-button {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #d4af37 0%, #f1c40f 100%);
            color: #1a1a1f !important;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            min-width: 200px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3);
            z-index: 1;
        }

        .primary-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f1c40f 0%, #d4af37 100%);
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: -1;
            border-radius: 50px;
        }

        .primary-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
            color: #1a1a1a;
        }

        .primary-button:hover::before {
            opacity: 1;
        }

        .primary-button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(212, 175, 55, 0.3);
        }

        .primary-button i {
            color: #1a1a1f;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .primary-button:hover i {
            transform: scale(1.1);
        }

        .primary-button:active {
            transform: translateY(0);
        }

        .primary-button i {
            font-size: 1.25rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            box-sizing: border-box;
        }
        
        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: calc(100vh - 2rem);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        /* Make sure the modal is scrollable on mobile */
        @media (max-width: 768px) {
            .modal {
                padding: 0.5rem;
                align-items: stretch;
                justify-content: flex-start;
                display: flex;
                flex-direction: column;
            }
            
            .modal-content {
                max-height: calc(100vh - 1rem);
                padding: 1.25rem 1rem;
                margin: 0.5rem auto;
                width: 100%;
                flex: 0 1 auto;
                border-radius: 0.75rem;
            }
            
            /* Ensure form elements are properly sized on mobile */
            .form-group {
                margin-bottom: 1rem;
            }
            
            input, select, textarea {
                padding: 0.75rem 1rem;
                font-size: 1rem;
                width: 100%;
                box-sizing: border-box;
            }
            
            /* Fix for iOS zoom on input focus */
            @supports (-webkit-overflow-scrolling: touch) {
                input, select, textarea {
                    font-size: 16px; /* Prevent iOS zoom */
                }
            }
            
            /* Ensure buttons are tappable on mobile */
            button, input[type="submit"] {
                min-height: 44px; /* Minimum touch target size */
            }
        }

        .close-modal {
            position: absolute;
            right: var(--spacing-md);
            top: var(--spacing-md);
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--secondary-color);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--primary-color);
        }

        .upload-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .upload-input {
            padding: var(--spacing-md);
            border: 2px dashed #e2e8f0;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: white;
        }

        .upload-input:hover {
            background-color: #f8fafc;
            border-color: var(--primary-color);
        }

        .budget-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .calculator-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .input-group {
            display: flex;
            gap: var(--spacing-md);
            flex-direction: column;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }
        
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
            letter-spacing: 0.01em;
        }

        input, select {
            padding: 0.8rem 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-family: inherit;
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s ease;
            background-color: #f9fafc;
        }
        
        /* Keep financial calculator inputs larger */
        .calculator-section input {
            padding: var(--spacing-lg);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .result {
            padding: var(--spacing-xl);
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius);
            margin-top: var(--spacing-lg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(5px);
        }

        .result h3 {
            margin-bottom: var(--spacing-lg);
            color: var(--text-color);
        }

        .result-container {
            margin-top: var(--spacing-lg);
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .result span {
            font-weight: 600;
            color: var(--primary-color);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-top: var(--spacing-xl);
            backdrop-filter: blur(5px);
        }

        .note {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: var(--secondary-color);
            font-size: 0.9rem;
            padding: var(--spacing-md);
            background: rgba(243, 244, 246, 0.9);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
            margin-top: var(--spacing-md);
        }

        .note i {
            color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
                align-items: center;
            }

            .modal-content {
                padding: var(--spacing-md);
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .form-group label {
                font-size: 1rem;
            }

            .primary-button {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Modern Navigation Header -->
    <header class="nav-header" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 2.5rem; background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(10px); box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2); position: fixed; top: 0; z-index: 1000; border-bottom: 1px solid rgba(212, 175, 55, 0.15);">
        <div class="brand" style="font-size: 1.6rem; font-weight: 800; display: flex; align-items: center; gap: 1.2rem; cursor: pointer;" onclick="window.location.href='#'">
            <img id="siteLogo" src="https://i.imgur.com/yQGiMd5.png" alt="Golden Balance Logo" style="height: 60px; width: auto; display: block;">
            <span style="background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Golden Balance</span>
        </div>
        
        <script>
            // Učitavanje loga iz localStorage-a ako postoji
            document.addEventListener('DOMContentLoaded', function() {
                // Učitavanje loga iz localStorage-a ako postoji
                const savedLogo = localStorage.getItem('site_logo');
                if (savedLogo) {
                    document.getElementById('siteLogo').src = savedLogo;
                }
                
                // Provera da li je korisnik administrator
                const adminEmail = 'zorandostica2@gmail.com';
                const loggedInUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
                const isAdmin = loggedInUser.email === adminEmail;
                
                // Prikaz admin dugmeta ako je korisnik administrator
                if (isAdmin || localStorage.getItem('admin_logged_in') === 'true') {
                    document.getElementById('adminSettingsBtn').style.display = 'block';
                }
                
                // Dodavanje hover animacije za zupčanik
                const spinIcon = document.querySelector('.fa-spin-hover');
                if (spinIcon) {
                    spinIcon.addEventListener('mouseover', function() {
                        this.classList.add('fa-spin');
                    });
                    spinIcon.addEventListener('mouseout', function() {
                        this.classList.remove('fa-spin');
                    });
                }
            });
        </script>
        
        <!-- Action Buttons -->
        <div class="header-actions" style="display: flex; gap: 1.2rem; align-items: center;">
            <!-- Admin Settings Button (Initially Hidden) -->
            <a href="admin.html" id="adminSettingsBtn" style="display: none; text-decoration: none;">
                <button class="ai-chat-button" style="background: var(--gradient-gold-dark); border: none; padding: 0.7rem 1.3rem; border-radius: var(--border-radius); display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: var(--box-shadow); font-weight: 500; color: white; transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-cog fa-spin-hover"></i>
                    <span>Admin Panel</span>
                </button>
            </a>
            
            <!-- Support Button -->
            <button class="ai-chat-button" id="supportBtn" style="background: var(--gradient-gold); border: none; padding: 0.7rem 1.3rem; border-radius: var(--border-radius); display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: var(--box-shadow); font-weight: 500; color: white; transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                <i class="fas fa-headset"></i>
                <span>Tehnička Podrška</span>
            </button>
            
            <!-- Navigation Link to Profile -->
            <a href="profile.html" style="text-decoration: none;">
                <button class="ai-chat-button" style="background: transparent; border: 1px solid var(--gold-dark); padding: 0.7rem 1.3rem; border-radius: var(--border-radius); display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; font-weight: 500; color: var(--light-text); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.background='rgba(212, 175, 55, 0.1)';" onmouseout="this.style.transform='translateY(0)'; this.style.background='transparent';">
                    <i class="fas fa-user" style="color: var(--gold-bright);"></i>
                    <span>Profil</span>
                </button>
            </a>
            
            <!-- When user is not logged in -->
            <div id="guestUser" class="auth-buttons" style="display: flex; gap: 1rem; align-items: center;">
                <button class="ai-chat-button" id="loginBtn" style="background: var(--dark-accent); border: 1px solid var(--gold-medium); padding: 0.7rem 1.3rem; border-radius: var(--border-radius); display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: var(--box-shadow); font-weight: 500; color: var(--gold-pale); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.borderColor='var(--gold-bright)';" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='var(--gold-medium)';">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Prijava</span>
                </button>
                <button class="ai-chat-button" id="registerBtn" style="background: var(--gradient-gold-dark); border: none; padding: 0.7rem 1.3rem; border-radius: var(--border-radius); display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; box-shadow: var(--box-shadow); font-weight: 500; color: white; transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    <i class="fas fa-user-plus"></i>
                    <span>Registracija</span>
                </button>
            </div>
            
            <!-- When user is logged in -->
            <div id="loggedInUser" class="logged-in-user" style="display: none; margin-left: 1rem;">
                <div class="profile-pic-container" style="position: relative;">
                    <img id="userProfilePic" src="https://via.placeholder.com/40" alt="Profilna slika" class="profile-pic" style="width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid #e2e8f0;" onclick="toggleProfileDropdown()">
                    <div id="profileDropdown" class="profile-dropdown" style="display: none; position: absolute; right: 0; top: 100%; background: white; min-width: 240px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 0.5rem; overflow: hidden; z-index: 1000;">
                        <div class="dropdown-header" style="padding: 0.75rem 1rem; background: #f8fafc; border-bottom: 1px solid #f1f5f9;">
                            <div style="font-weight: 600; font-size: 0.9rem;" id="dropdownUserName">Ime Prezime</div>
                            <div style="font-size: 0.8rem; color: #64748b;" id="dropdownUserEmail">email@example.com</div>
                        </div>
                        <a href="profile.html" class="dropdown-item" style="display: flex; align-items: center; padding: 0.75rem 1rem; color: #1a1a1a; text-decoration: none; transition: background 0.2s; font-size: 0.9rem; border-bottom: 1px solid #f1f5f9;">
                            <i class="fas fa-user-edit" style="width: 20px; margin-right: 0.5rem; color: #3b82f6;"></i> Moj Profil
                        </a>
                        <a href="profile.html#budget" class="dropdown-item" style="display: flex; align-items: center; padding: 0.75rem 1rem; color: #1a1a1a; text-decoration: none; transition: background 0.2s; font-size: 0.9rem; border-bottom: 1px solid #f1f5f9;">
                            <i class="fas fa-wallet" style="width: 20px; margin-right: 0.5rem; color: #10b981;"></i> Moj Budžet
                        </a>
                        <a href="profile.html#settings" class="dropdown-item" style="display: flex; align-items: center; padding: 0.75rem 1rem; color: #1a1a1a; text-decoration: none; transition: background 0.2s; font-size: 0.9rem; border-bottom: 1px solid #f1f5f9;">
                            <i class="fas fa-cog" style="width: 20px; margin-right: 0.5rem; color: #6b7280;"></i> Podešavanja
                        </a>
                        <div style="padding: 0.5rem 1rem; border-top: 1px solid #f1f5f9;">
                            <a href="#" id="logoutBtn" class="dropdown-item" style="display: flex; align-items: center; padding: 0.5rem 0; color: #dc2626; text-decoration: none; font-size: 0.9rem; font-weight: 500;">
                                <i class="fas fa-sign-out-alt" style="width: 20px; margin-right: 0.5rem;"></i> Odjava
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // Button click handlers
            document.getElementById('loginBtn')?.addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'block';
            });
            
            document.getElementById('registerBtn')?.addEventListener('click', () => {
                document.getElementById('registerModal').style.display = 'block';
            });
            
            document.getElementById('supportBtn')?.addEventListener('click', () => {
                document.getElementById('supportModal').style.display = 'block';
            });
            
            // Toggle profile dropdown
            function toggleProfileDropdown() {
                const dropdown = document.getElementById('profileDropdown');
                dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const dropdown = document.getElementById('profileDropdown');
                const profilePic = document.getElementById('userProfilePic');
                if (dropdown && !dropdown.contains(e.target) && e.target !== profilePic) {
                    dropdown.style.display = 'none';
                }
            });
        </script>
    </header>
    
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content auth-modal">
            <span class="close-modal">&times;</span>
            <h2><i class="fas fa-sign-in-alt"></i> Prijava</h2>
            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="loginEmail">Email adresa</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Lozinka</label>
                    <div class="password-input">
                        <input type="password" id="loginPassword" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div class="form-footer">
                    <label class="remember-me">
                        <input type="checkbox" id="rememberMe"> Zapamti me
                    </label>
                    <a href="#" class="forgot-password">Zaboravili ste lozinku?</a>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Prijavi se</button>
                <div class="divider">ili se prijavite sa</div>
                <div class="social-login">
                    <button type="button" class="btn btn-google">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button type="button" class="btn btn-facebook">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>
                <p class="auth-switch">Nemate nalog? <a href="#" id="showRegister">Registrujte se</a></p>
            </form>
        </div>
    </div>
    
    <!-- Registration Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content auth-modal">
            <span class="close-modal">&times;</span>
            <h2><i class="fas fa-user-plus"></i> Registracija</h2>
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="regFullName">Ime i prezime</label>
                    <input type="text" id="regFullName" required>
                </div>
                <div class="form-group">
                    <label for="regEmail">Email adresa</label>
                    <input type="email" id="regEmail" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Lozinka</label>
                    <div class="password-input">
                        <input type="password" id="regPassword" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('regPassword')">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>
                    <div class="password-strength">
                        <div class="strength-bar"></div>
                        <span class="strength-text">Jačina lozinke: <span id="strengthText">Slaba</span></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="regConfirmPassword">Potvrdi lozinku</label>
                    <input type="password" id="regConfirmPassword" required>
                </div>
                <div class="form-group">
                    <label class="profile-picture-upload">
                        <input type="file" id="profilePictureUpload" accept="image/*" style="display: none;">
                        <i class="fas fa-camera"></i> <span>Dodajte profilnu sliku</span>
                    </label>
                    <div id="previewContainer" class="preview-container" style="display: none;">
                        <img id="imagePreview" src="" alt="Preview">
                        <button type="button" id="removeImage" class="remove-image">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="form-group terms">
                    <label class="checkbox-container">
                        <input type="checkbox" id="agreeTerms" required>
                        <span class="checkmark"></span>
                        Prihvatam <a href="#" class="terms-link">uslove korišćenja</a> i 
                        <a href="#" class="terms-link">politiku privatnosti</a>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Registruj se</button>
                <p class="auth-switch">Već imate nalog? <a href="#" id="showLogin">Prijavite se</a></p>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="hero-section">
            <h1 class="hero-title">Optimizujte vaše finansije uz našu pomoć.</h1>
            <p class="hero-description">
                Dobrodošli u Golden Balance - vašeg pouzdanog partnera u upravljanju ličnim finansijama. 
                Naša platforma vam pruža sve što vam je potrebno da postignete finansijsku stabilnost i sigurnost.
            </p>
            <div class="features-grid">
                <div class="feature-card">
                    <i class="fas fa-chart-pie"></i>
                    <h3>Pratite troškove</h3>
                    <p>Pratite sve vaše troškove na jednom mestu i identifikujte gde možete uštedeti.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-coins"></i>
                    <h3>Ušteda i štednja</h3>
                    <p>Postavite ciljeve štednje i pratite vaš napredak ka njihovom ostvarenju.</p>
                </div>
                <div class="feature-card">
                    <i class="fas fa-chart-line"></i>
                    <h3>Pametno investiranje</h3>
                    <p>Koristite naše alate za praćenje i analizu vaših investicija.</p>
                </div>
            </div>
        </div>
        
        <!-- Sadržaj je premešten u modal prozor -->
        
            <div class="button-group">
                <a href="profile.html?directToBudget=true#budget" class="primary-button" style="text-decoration: none; text-align: center;">
                    <i class="fas fa-wallet"></i>
                    Lične finansije
                </a>
                <a href="profile.html#budget" class="primary-button" style="text-decoration: none; text-align: center;">
                    <i class="fas fa-chart-bar"></i>
                    Praćenje budžeta
                </a>
                <button class="primary-button" onclick="openModal('calculatorModal')">
                    <i class="fas fa-calculator"></i>
                    Finansijski kalkulator
                </button>

                <button class="primary-button" onclick="openModal('consultationModal')">
                    <i class="fas fa-calendar-check"></i>
                    Zakažite konsultacije
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="uploadModal" class="modal">
        <div class="modal-content" style="max-width: 650px;">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            
            <!-- Step 1: Financial Information -->
            <div id="financialInfoStep" class="form-step active">
                <h2><i class="fas fa-file-invoice-dollar"></i> Unos finansijskih podataka</h2>
                <p class="form-description">Unesite vaše osnovne finansijske podatke kako bismo vam pomogli sa analizom.</p>
                
                <div class="form-group">
                    <label for="monthlyIncome">Mesečni prihodi (RSD)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-wallet"></i>
                        <input type="number" id="monthlyIncome" placeholder="Unesite iznos" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="monthlyExpenses">Mesečni troškovi (RSD)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-shopping-cart"></i>
                        <input type="number" id="monthlyExpenses" placeholder="Unesite iznos" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Kategorije troškova (opciono)</label>
                    <div id="expenseCategories">
                        <!-- Dynamic expense categories will be added here -->
                    </div>
                    <button type="button" class="btn-outline" onclick="addExpenseCategory()" style="margin-top: 0.5rem;">
                        <i class="fas fa-plus"></i> Dodaj kategoriju
                    </button>
                </div>
                
                <div class="form-actions" style="margin-top: 2rem;">
                    <button type="button" class="btn btn-primary" onclick="showGoalsSection()" style="width: 100%;">
                        Dalje <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <!-- Step 2: Financial Goals -->
            <div id="goalsStep" class="form-step" style="display: none;">
                <h2><i class="fas fa-bullseye"></i> Vaši finansijski ciljevi</h2>
                <p class="form-description">Izaberite ciljeve koje želite da postignete kako bismo vam pomogli da ih ostvarite.</p>
                
                <div class="goals-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 1.5rem 0;">
                    <div class="goal-card" data-goal="savings" onclick="selectGoal(this)" style="padding: 1.5rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-piggy-bank" style="font-size: 2rem; color: #3b82f6; margin-bottom: 0.5rem;"></i>
                        <div>Štednja</div>
                    </div>
                    <div class="goal-card" data-goal="investment" onclick="selectGoal(this)" style="padding: 1.5rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-chart-line" style="font-size: 2rem; color: #10b981; margin-bottom: 0.5rem;"></i>
                        <div>Investiranje</div>
                    </div>
                    <div class="goal-card" data-goal="property" onclick="selectGoal(this)" style="padding: 1.5rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-home" style="font-size: 2rem; color: #8b5cf6; margin-bottom: 0.5rem;"></i>
                        <div>Kupovina stana/kuće</div>
                    </div>
                    <div class="goal-card" data-goal="retirement" onclick="selectGoal(this)" style="padding: 1.5rem; border: 2px solid #e2e8f0; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s ease;">
                        <i class="fas fa-umbrella-beach" style="font-size: 2rem; color: #f59e0b; margin-bottom: 0.5rem;"></i>
                        <div>Penziono osiguranje</div>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label for="goalDescription">Detaljnije opišite vaše ciljeve (opciono)</label>
                    <textarea id="goalDescription" rows="3" placeholder="Šta želite da postignete? Kada? Koliko vam je novca potrebno?" style="width: 100%; padding: 0.75rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; font-family: inherit; resize: vertical; min-height: 100px;"></textarea>
                </div>
                
                <div class="form-actions" style="display: flex; justify-content: space-between; margin-top: 2rem;">
                    <button type="button" class="btn btn-outline" onclick="backToFinancialInfo()">
                        <i class="fas fa-arrow-left"></i> Nazad
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitFinancialData()">
                        Potvrdi i pošalji <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Results & Advisor -->
            <div id="resultsStep" class="form-step" style="display: none; text-align: center;">
                <div style="font-size: 4rem; color: #10b981; margin: 1rem 0;">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>Hvala na unosu podataka!</h2>
                <p class="form-description">Na osnovu unetih podataka, evo vaše finansijske analize i preporuka.</p>
                
                <div style="background: #f8fafc; border-radius: 0.5rem; padding: 1.5rem; margin: 2rem 0; text-align: left;">
                    <h3 style="margin-top: 0; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.75rem; margin-bottom: 1.25rem; color: #1e293b;">Pregled vaših finansija</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                        <span>Mesečni prihodi:</span>
                        <strong id="summaryIncome">0 RSD</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                        <span>Mesečni troškovi:</span>
                        <strong id="summaryExpenses">0 RSD</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 1rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0; font-size: 1.1rem; color: #1e293b; font-weight: 600;">
                        <span>Raspoloživo mesečno:</span>
                        <strong id="summaryAvailable">0 RSD</strong>
                    </div>
                </div>
                
                <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1rem; margin: 2rem 0; text-align: left; border-radius: 0 0.5rem 0.5rem 0;">
                    <h3 style="margin-top: 0; margin-bottom: 0.5rem; color: #065f46; font-size: 1.1rem;">
                        <i class="fas fa-lightbulb" style="margin-right: 0.5rem;"></i> Naša preporuka
                    </h3>
                    <p id="recommendationText" style="margin: 0; color: #065f46; line-height: 1.5;">
                        Na osnovu vaših ciljeva, preporučujemo vam da zakažete sastanak sa finansijskim savetnikom kako biste razvili detaljan plan za postizanje vaših ciljeva.
                    </p>
                </div>
                
                <div style="margin-top: 2rem;">
                    <button type="button" class="btn btn-primary" onclick="scheduleAdvisorMeeting()" style="padding: 0.75rem 2rem; font-size: 1rem;">
                        <i class="fas fa-calendar-check" style="margin-right: 0.5rem;"></i> Zakaži sastanak sa savetnikom
                    </button>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button type="button" class="btn btn-outline" onclick="closeModal()" style="padding: 0.5rem 1.5rem;">
                        Zatvori
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>Praćenje svakodnevnih troškova</h2>
            <div class="budget-section">
                <div class="form-group">
                    <label for="date">Datum</label>
                    <input type="date" id="date">
                </div>
                <div class="form-group">
                    <label for="category">Kategorija</label>
                    <select id="category">
                        <option value="hrana">Hrana</option>
                        <option value="transport">Transport</option>
                        <option value="zabava">Zabava</option>
                        <option value="kupovina">Kupovina</option>
                        <option value="ostalo">Ostalo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">Iznos</label>
                    <input type="number" id="amount" required>
                </div>
                <div class="form-group">
                    <label for="description">Opis</label>
                    <input type="text" id="description">
                </div>
                <button class="primary-button" onclick="addExpense()" style="width: 100%;">
                    <i class="fas fa-plus"></i>
                    Dodaj trošak
                </button>
                <div class="expenses-list" style="margin-top: 1rem;"></div>
                <div class="total-expenses" style="margin-top: 1rem; text-align: right;"></div>
            </div>
        </div>
    </div>

    <div id="calculatorModal" class="modal">
        <div class="modal-content" style="background: #ffffff; border: 1px solid #D4AF37; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);">
            <span class="close-modal" onclick="closeModal()" style="color: #000000;">&times;</span>
            <h2 style="color: #D4AF37; text-align: center; margin-bottom: 1.5rem; font-size: 1.8rem; font-weight: 700; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                <i class="fas fa-calculator" style="margin-right: 10px; color: #D4AF37;"></i>Finansijski kalkulator
            </h2>
            
            <div class="calculator-section" style="padding: 0 1.5rem 1.5rem;">
                <div class="calculator-instructions" style="margin-bottom: 2rem; background: #FFF9E6; padding: 1.25rem; border-radius: 10px; border-left: 4px solid #D4AF37; color: #333333; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);">
                    <h3 style="margin-top: 0; color: #D4AF37; font-weight: 700; font-size: 1.2rem; margin-bottom: 0.75rem; display: flex; align-items: center;">
                        <i class="fas fa-info-circle" style="margin-right: 8px; color: #D4AF37;"></i>Kako koristiti kalkulator:
                    </h3>
                    <ul style="margin: 0; padding-left: 1.5rem; color: #333333; line-height: 1.7;">
                        <li style="margin-bottom: 0.5rem;"><span style="color: #D4AF37; font-weight: 600;">Period štednje</span> - Ukupan broj godina planirane štednje</li>
                        <li style="margin-bottom: 0.5rem;"><span style="color: #D4AF37; font-weight: 600;">Godišnja uplata</span> - Iznos koji planirate da ulažete svake godine</li>
                        <li><span style="color: #D4AF37; font-weight: 600;">Stopa prinosa</span> - Očekivani godišnji prinos (podrazumevano 7%)</li>
                    </ul>
                </div>
                
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label for="investmentPeriod" style="display: block; margin-bottom: 0.5rem; color: #333333; font-weight: 600;">Period štednje (godine)</label>
                    <div style="position: relative;">
                        <input type="number" id="investmentPeriod" required 
                               placeholder="Unesite broj godina" 
                               min="1" 
                               step="1"
                               style="width: 100%; padding: 0.85rem 1rem; background: #ffffff; border: 2px solid #D4AF37; border-radius: 8px; color: #333333; font-size: 1rem; transition: all 0.3s ease;"
                               onfocus="this.borderColor='#B8860B'; this.boxShadow='0 0 0 3px rgba(212, 175, 55, 0.2)';"
                               onblur="this.borderColor='#D4AF37'; this.boxShadow='none';">
                        <i class="fas fa-calendar-alt" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #D4AF37;"></i>
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label for="annualDeposit" style="display: block; margin-bottom: 0.5rem; color: #333333; font-weight: 600;">Godišnja uplata (RSD)</label>
                    <div style="position: relative;">
                        <input type="number" id="annualDeposit" required 
                               placeholder="Unesite iznos u RSD" 
                               min="1" 
                               step="1000"
                               style="width: 100%; padding: 0.85rem 1rem; background: #ffffff; border: 2px solid #D4AF37; border-radius: 8px; color: #333333; font-size: 1rem; transition: all 0.3s ease;"
                               onfocus="this.borderColor='#B8860B'; this.boxShadow='0 0 0 3px rgba(212, 175, 55, 0.2)';"
                               onblur="this.borderColor='#D4AF37'; this.boxShadow='none';">
                        <i class="fas fa-wallet" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #D4AF37;"></i>
                    </div>
                </div>
                
                <div class="note" style="background: #FFF9E6; color: #333333; border-left: 3px solid #D4AF37; padding: 0.85rem 1rem; border-radius: 8px; margin: 1.5rem 0; display: flex; align-items: center;">
                    <i class="fas fa-info-circle" style="color: #D4AF37; font-size: 1.1rem; margin-right: 10px;"></i>
                    <span>Podrazumevana godišnja kamatna stopa iznosi <strong style="color: #D4AF37;">7%</strong></span>
                </div>
                <button class="primary-button" onclick="calculateInvestment()" style="width: 100%; margin-top: 0.5rem; padding: 1rem; font-size: 1.05rem; background: linear-gradient(135deg, #D4AF37 0%, #F1C40F 100%); border: none; border-radius: 8px; box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); color: #1a1a1f; font-weight: 600; transition: all 0.3s ease; cursor: pointer;" 
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(212, 175, 55, 0.4)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(212, 175, 55, 0.3)';">
                    <i class="fas fa-calculator" style="margin-right: 8px;"></i>
                    Izračunaj povrat
                </button>
                
                <div id="investmentResult" style="display: none; margin-top: 2rem; background: #ffffff; border-radius: 10px; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); border: 1px solid #E5E7EB;">
                    <h3 style="color: #D4AF37; border-bottom: 1px solid #E5E7EB; padding-bottom: 0.75rem; margin-top: 0; font-size: 1.4rem; display: flex; align-items: center;">
                        <i class="fas fa-chart-line" style="margin-right: 10px; color: #D4AF37;"></i>Rezultati investicije
                    </h3>
                    <div class="chart-container" style="margin: 1.5rem 0;">
                        <canvas id="investmentChart" style="width: 100%; height: 280px;"></canvas>
                    </div>
                    <div class="result-details" style="margin-top: 1.5rem; color: #333333;">
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #F3F4F6;">
                            <span style="color: #4B5563;">Ukupno investirano:</span>
                            <strong style="color: #1F2937; font-weight: 700;" id="totalInvested"></strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #F3F4F6;">
                            <span style="color: #4B5563;">Ukupan povrat:</span>
                            <strong style="color: #10B981; font-weight: 700;" id="totalReturn"></strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #F3F4F6;">
                            <span style="color: #4B5563;">Ukupan profit:</span>
                            <strong style="color: #10B981; font-weight: 700;" id="totalProfit"></strong>
                        </div>
                        <div style="display: none; justify-content: space-between; padding: 0.75rem 0;">
                            <span style="color: #4B5563;">Kamatni dohodak:</span>
                            <strong style="color: #10B981; font-weight: 700;" id="compoundInterest"></strong>
                        </div>
                        </div>

                        <script>
                            document.getElementById('compoundInterest').textContent = compoundInterest;
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="supportModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>Korisnička podrška</h2>
            <div class="support-section">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages"></div>
                    <div class="chat-input">
                        <input type="text" id="userMessage" placeholder="Unesite vaše pitanje...">
                        <button class="primary-button" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="consultationModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2>Zakazivanje konsultacija</h2>
            <div class="consultation-section">
                <p>Možete zakazati konsultaciju putem sljedećeg linka:</p>
                <a href="https://tvoj-finansijski-savetnik.carrd.co/" target="_blank" class="primary-button" style="width: 100%;">
                    <i class="fas fa-external-link-alt"></i>
                    Idi na Carrd stranicu
                </a>
            </div>
        </div>
    </div>

    <!-- Add Font Awesome -->
    <script src="https://kit.fontawesome.com/your-code.js" crossorigin="anonymous"></script>
    <!-- Add Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Funkcija za zatvaranje modala
        function closeModal() {
            // Zatvori sve modale
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            
            // Ukloni modal-open klasu sa body-ja
            document.body.classList.remove('modal-open');
            
            // Vrati scroll na vrh
            window.scrollTo(0, 0);
            
            // Resetuj samo input polja za kalkulator
            const investmentPeriod = document.getElementById('investmentPeriod');
            const annualDeposit = document.getElementById('annualDeposit');
            
            if (investmentPeriod) investmentPeriod.value = '';
            if (annualDeposit) annualDeposit.value = '';
            
            // Sakrij samo rezultate kalkulatora
            const resultDiv = document.getElementById('investmentResult');
            if (resultDiv) {
                resultDiv.style.display = 'none';
            }
            
            // Uništi grafikone kalkulatora
            const chartCanvas = document.getElementById('investmentChart');
            if (chartCanvas) {
                const chartInstance = Chart.getChart(chartCanvas);
                if (chartInstance) {
                    chartInstance.destroy();
                }
            }
        }
        
        // Funkcija za otvaranje modala
        function openModal(modalId) {
            console.log('Otvaram modal:', modalId);
            const modal = document.getElementById(modalId);
            if (modal) {
                // Zatvori sve druge modale prvo
                closeModal();
                
                // Postavi event listener za ESC taster
                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleKeyDown);
                    }
                };
                
                // Dodaj event listener
                document.addEventListener('keydown', handleKeyDown);
                
                // Prikaži željeni modal
                modal.style.display = 'flex';
                document.body.classList.add('modal-open');
                
                // Postavi event listener za klik izvan modala
                modal.addEventListener('click', function outsideClick(e) {
                    if (e.target === modal) {
                        closeModal();
                        modal.removeEventListener('click', outsideClick);
                    }
                });
                
                // Fokusiraj prvo input polje u modalu ako postoji
                setTimeout(() => {
                    const firstInput = modal.querySelector('input:not([type="hidden"]), select, textarea, button');
                    if (firstInput) firstInput.focus();
                }, 100);
            } else {
                console.error('Modal sa ID-jem', modalId, 'nije pronađen');
            }
        }
        
        // Funkcija za izračunavanje investicije
        function calculateInvestment() {
            const period = parseFloat(document.getElementById('investmentPeriod').value);
            const annualDeposit = parseFloat(document.getElementById('annualDeposit').value);
            
            if (!period || !annualDeposit) {
                alert('Molimo unesite sve potrebne podatke.');
                return;
            }
            
            // Konstante za izračun
            const annualRate = 0.07; // 7% godišnja kamatna stopa
            const years = period;
            const monthlyRate = annualRate / 12;
            const months = years * 12;
            
            // Nizovi za čuvanje podataka za grafikon
            const labels = [];
            const totalInvestedData = [];
            const totalValueData = [];
            
            // Promenljive za praćenje
            let totalInvested = 0;
            let totalValue = 0;
            
            // Godišnji priliv
            const yearlyDeposit = annualDeposit;
            
            // Izračun za svaku godinu
            for (let year = 0; year <= years; year++) {
                // Dodajemo godišnji ulog na početku svake godine (osim prve)
                if (year > 0) {
                    totalInvested += yearlyDeposit;
                    totalValue += yearlyDeposit;
                }
                
                // Ako nije poslednja godina, primenjujemo kamatu
                if (year < years) {
                    // Mesečni prinos
                    totalValue *= Math.pow(1 + monthlyRate, 12);
                }
                
                // Dodajemo podatke za grafikon
                labels.push(`Godina ${year}`);
                totalInvestedData.push(totalInvested);
                totalValueData.push(totalValue);
            }
            
            // Prikaz rezultata
            const resultDiv = document.getElementById('investmentResult');
            document.getElementById('totalInvested').textContent = formatCurrency(totalInvested, false) + ' RSD';
            document.getElementById('totalReturn').textContent = formatCurrency(totalValue, false) + ' RSD';
            document.getElementById('totalProfit').textContent = formatCurrency(totalValue - totalInvested, false) + ' RSD';
            
            // Prikaz rezultata
            resultDiv.style.display = 'block';
            
            // Kreiranje grafika
            createChart(labels, totalInvestedData, totalValueData);
            
            // Funkcija za formatiranje valute
            function formatCurrency(amount, includeCurrency = true) {
                return amount.toLocaleString('de-DE', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).replace(/\./g, 'X').replace(/,/g, '.').replace(/X/g, ',');
            }
            
            // Funkcija za kreiranje grafika
            function createChart(labels, investedData, valueData) {
                const ctx = document.getElementById('investmentChart').getContext('2d');
                
                // Uništi postojeći grafik ako postoji
                const existingChart = Chart.getChart('investmentChart');
                if (existingChart) {
                    existingChart.destroy();
                }
                
                // Kreiranje novog grafika
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Ukupno uloženo (RSD)',
                            data: investedData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }, {
                            label: 'Ukupna vrednost (RSD)',
                            data: valueData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Rast vaše investicije tokom vremena',
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                },
                                padding: {
                                    top: 10,
                                    bottom: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += formatCurrency(context.parsed.y, false) + ' RSD';
                                        }
                                        return label;
                                    }
                                }
                            },
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Godine',
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                grid: {
                                    display: false
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Iznos (RSD)',
                                    font: {
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return formatCurrency(value, false) + ' RSD';
                                    }
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        },
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        }
                    }
                });
            }
        }
        
        // Otvaranje čarobnjaka za kreiranje budžeta
        function openBudgetWizard() {
            const isLoggedIn = localStorage.getItem('currentUser') !== null;
            
            if (!isLoggedIn) {
                // Ako korisnik nije prijavljen, prikaži login modal
                alert('Molimo vas da se prijavite kako biste pristupili funkcijama ličnih finansija.');
                document.getElementById('loginModal').style.display = 'flex';
                return;
            }
            
            // Ako je korisnik prijavljen, preusmeri ga na profil stranicu u sekciju budžeta
            window.location.href = 'profile.html#budget';
        }

        // Formatiranje valute
        function formatCurrency(value, includeCurrency = true) {
            const formatter = new Intl.NumberFormat('sr-RS', {
                style: includeCurrency ? 'currency' : 'decimal',
                currency: 'RSD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });
            return formatter.format(value);
        }

        // User State
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        
        // Initialize modals
        const modals = {
            aiChat: document.getElementById('aiChatModal'),
            login: document.getElementById('loginModal'),
            register: document.getElementById('registerModal')
        };
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.classList.remove('modal-open');
                document.activeElement.blur();
            }
        }
        
        // Toggle modals
        document.querySelectorAll('[data-modal]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const modalId = btn.getAttribute('data-modal');
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'block';
                    document.body.classList.add('modal-open');
                    
                    // Focus first input if exists
                    const firstInput = modal.querySelector('input:not([type="hidden"]), select, textarea');
                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                }
            });
        });
        
        // Close buttons
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const modal = btn.closest('.modal');
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
                document.activeElement.blur();
            });
        });
        
        // Toggle between login and register forms
        document.getElementById('showRegister')?.addEventListener('click', (e) => {
            e.preventDefault();
            modals.login.style.display = 'none';
            modals.register.style.display = 'block';
        });
        
        document.getElementById('showLogin')?.addEventListener('click', (e) => {
            e.preventDefault();
            modals.register.style.display = 'none';
            modals.login.style.display = 'block';
        });
        
        // Profile picture upload preview
        const profilePicUpload = document.getElementById('profilePicUpload');
        const profilePicPreview = document.getElementById('profilePicPreview');
        const previewImage = document.getElementById('previewImage');
        
        if (profilePicUpload) {
            profilePicUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        previewImage.src = event.target.result;
                        profilePicPreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            document.getElementById('removeProfilePic')?.addEventListener('click', () => {
                profilePicUpload.value = '';
                profilePicPreview.style.display = 'none';
            });
        }
        
        // Login form submission
        document.getElementById('loginForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            // In a real app, you would validate credentials with a server
            // For demo purposes, we'll simulate a successful login
            simulateLogin({
                name: email.split('@')[0],
                email: email,
                profilePic: 'https://via.placeholder.com/150'
            }, rememberMe);
            
            modals.login.style.display = 'none';
        });
        
        // Register form submission
        document.addEventListener('DOMContentLoaded', function() {
            const registerForm = document.getElementById('registerForm');
            const profilePicUpload = document.getElementById('profilePictureUpload');
            const profilePicPreview = document.getElementById('previewContainer');
            
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const name = document.getElementById('regFullName').value.trim();
                    const email = document.getElementById('regEmail').value.trim();
                    const password = document.getElementById('regPassword').value;
                    const confirmPassword = document.getElementById('regConfirmPassword').value;
                    const agreeTerms = document.getElementById('agreeTerms').checked;
                    
                    // Validate form
                    if (!name || !email || !password || !confirmPassword) {
                        alert('Molimo popunite sva obavezna polja!');
                        return;
                    }
                    
                    if (!agreeTerms) {
                        alert('Morate prihvatiti uslove korišćenja!');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        alert('Lozinke se ne podudaraju!');
                        return;
                    }
                    
                    // Create user object
                    const userData = {
                        name: name,
                        email: email,
                        profilePic: 'https://via.placeholder.com/150'
                    };
                    
                    // Handle profile picture if uploaded
                    if (profilePicUpload.files && profilePicUpload.files[0]) {
                        userData.profilePic = URL.createObjectURL(profilePicUpload.files[0]);
                    }
                    
                    // Simulate registration (in real app, you would send this to a server)
                    simulateLogin(userData, true);
                    
                    // Close modal and reset form
                    const registerModal = document.getElementById('registerModal');
                    if (registerModal) registerModal.style.display = 'none';
                    registerForm.reset();
                    if (profilePicPreview) profilePicPreview.style.display = 'none';
                    
                    // Show success message
                    alert('Uspešno ste se registrovali!');
                    
                    // Redirect to home page
                    window.location.href = 'index.html';
                });
            }
        });
        
        // Logout
        document.getElementById('logoutBtn')?.addEventListener('click', (e) => {
            e.preventDefault();
            logout();
        });
        
        // Simulate login function
        function simulateLogin(userData, remember) {
            currentUser = userData;
            if (remember) {
                localStorage.setItem('currentUser', JSON.stringify(userData));
            } else {
                sessionStorage.setItem('currentUser', JSON.stringify(userData));
            }
            updateUI();
        }
        
        // Logout function
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            sessionStorage.removeItem('currentUser');
            updateUI();
        }
        
        // Update UI based on auth state
        function updateUI() {
            const guestUser = document.getElementById('guestUser');
            const loggedInUser = document.getElementById('loggedInUser');
            
            if (currentUser) {
                guestUser.style.display = 'none';
                loggedInUser.style.display = 'flex';
                
                // Update profile picture
                const userProfilePic = document.getElementById('userProfilePic');
                if (userProfilePic && currentUser.profilePic) {
                    userProfilePic.src = currentUser.profilePic;
                }
                
                // Update dropdown user info
                const dropdownUserName = document.getElementById('dropdownUserName');
                const dropdownUserEmail = document.getElementById('dropdownUserEmail');
                
                if (dropdownUserName && currentUser.name) {
                    dropdownUserName.textContent = currentUser.name;
                }
                
                if (dropdownUserEmail && currentUser.email) {
                    dropdownUserEmail.textContent = currentUser.email;
                }
            } else {
                guestUser.style.display = 'flex';
                loggedInUser.style.display = 'none';
            }
        }
        
        // Financial Form State
        let selectedGoals = [];
        let expenseCategories = [];
        
        // Add Expense Category
        function addExpenseCategory() {
            const categoryId = 'category-' + Date.now();
            const categoryHtml = `
                <div class="form-row" id="${categoryId}" style="margin-bottom: 0.75rem;">
                    <div class="form-group" style="flex: 2;">
                        <div class="input-with-icon">
                            <i class="fas fa-tag"></i>
                            <input type="text" placeholder="Naziv kategorije" class="category-name">
                        </div>
                    </div>
                    <div class="form-group" style="flex: 1.5;">
                        <div class="input-with-icon">
                            <i class="fas fa-money-bill"></i>
                            <input type="number" placeholder="Iznos (RSD)" class="category-amount">
                        </div>
                    </div>
                    <button type="button" class="btn btn-outline" onclick="removeExpenseCategory('${categoryId}')" style="align-self: flex-end; margin-bottom: 0.75rem;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            document.getElementById('expenseCategories').insertAdjacentHTML('beforeend', categoryHtml);
        }
        
        // Remove Expense Category
        function removeExpenseCategory(id) {
            const element = document.getElementById(id);
            if (element) element.remove();
        }
        
        // Select/Deselect Goal
        function selectGoal(element) {
            const goal = element.getAttribute('data-goal');
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                selectedGoals = selectedGoals.filter(g => g !== goal);
            } else {
                element.classList.add('selected');
                selectedGoals.push(goal);
            }
        }
        
        // Navigation between form steps
        function showGoalsSection() {
            const income = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            const expenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            
            if (!income || !expenses) {
                alert('Molimo unesite sve obavezne podatke.');
                return;
            }
            
            // Collect expense categories
            expenseCategories = [];
            document.querySelectorAll('.form-row[id^="category-"]').forEach(row => {
                const name = row.querySelector('.category-name').value;
                const amount = parseFloat(row.querySelector('.category-amount').value) || 0;
                if (name && amount > 0) {
                    expenseCategories.push({ name, amount });
                }
            });
            
            document.getElementById('financialInfoStep').classList.remove('active');
            document.getElementById('goalsStep').style.display = 'block';
            document.getElementById('goalsStep').classList.add('active');
        }
        
        function backToFinancialInfo() {
            document.getElementById('goalsStep').classList.remove('active');
            document.getElementById('financialInfoStep').style.display = 'block';
            document.getElementById('financialInfoStep').classList.add('active');
        }
        
        // Submit Financial Data
        function submitFinancialData() {
            const income = parseFloat(document.getElementById('monthlyIncome').value) || 0;
            const expenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const goalDescription = document.getElementById('goalDescription').value;
            
            // Update summary
            document.getElementById('summaryIncome').textContent = income.toLocaleString() + ' RSD';
            document.getElementById('summaryExpenses').textContent = expenses.toLocaleString() + ' RSD';
            document.getElementById('summaryAvailable').textContent = (income - expenses).toLocaleString() + ' RSD';
            
            // Generate recommendation
            const recommendation = generateRecommendation(income, expenses, selectedGoals, expenseCategories);
            document.getElementById('recommendationText').textContent = recommendation;
            
            // Show results
            document.getElementById('goalsStep').classList.remove('active');
            document.getElementById('resultsStep').style.display = 'block';
            document.getElementById('resultsStep').classList.add('active');
        }
        
        // Generate Recommendation
        function generateRecommendation(income, expenses, goals, categories) {
            const available = income - expenses;
            let recommendation = '';
            
            if (available <= 0) {
                return 'Na osnovu unetih podataka, troškovi premašuju vaše prihode. Preporučujemo da razmotrite smanjenje troškova kako biste izbegli dugove.';
            }
            
            const savingsRatio = (available / income) * 100;
            
            if (savingsRatio < 10) {
                recommendation += 'Preporučujemo vam da razmotrite načine za povećanje uštede. ';
            } else if (savingsRatio >= 20) {
                recommendation += 'Odlično štedite! ';
            }
            
            if (goals.length > 0) {
                recommendation += `Vaši izabrani ciljevi (${goals.join(', ').replace(/, ([^,]*)$/, ' i $1')}) zahtevaju redovno planiranje. `;
            }
            
            if (categories.length > 0) {
                const largestCategory = categories.reduce((prev, current) => 
                    (prev.amount > current.amount) ? prev : current
                );
                recommendation += `Najveći deo vaših troškova čini kategorija "${largestCategory.name}" (${(largestCategory.amount/expenses*100).toFixed(0)}%). `;
            }
            
            recommendation += 'Za personalizovane savete, preporučujemo sastanak sa našim finansijskim savetnikom.';
            
            return recommendation;
        }
        
        // Schedule Advisor Meeting
        function scheduleAdvisorMeeting() {
            // Otvaranje stranice za zakazivanje sastanka
            window.location.href = 'https://tvoj-finansijski-savetnik.carrd.co/';
            closeModal();
        }
        
        // Check auth state on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check for user in session storage first, then local storage
            const sessionUser = sessionStorage.getItem('currentUser');
            const localUser = localStorage.getItem('currentUser');
            
            if (sessionUser) {
                currentUser = JSON.parse(sessionUser);
            } else if (localUser) {
                currentUser = JSON.parse(localUser);
            }
            
            updateUI();
            
            // Add initial expense category
            addExpenseCategory();
        });
        
        // AI Chat modal
        document.querySelector('.ai-chat-button').onclick = function() {
            modals.aiChat.style.display = 'block';
        };
        
        document.querySelector('.close').onclick = function() {
            modals.aiChat.style.display = 'none';
        };

        // Budget tracking functionality
        function addExpense() {
            const date = document.getElementById('date').value;
            const category = document.getElementById('category').value;
            const amount = document.getElementById('amount').value;
            const description = document.getElementById('description').value;

            const expensesList = document.querySelector('.expenses-list');
            const totalExpenses = document.querySelector('.total-expenses');

            const expenseItem = document.createElement('div');
            expenseItem.className = 'expense-item';
            expenseItem.innerHTML = `
                <div class="expense-details">
                    <p><strong>Datum:</strong> ${date}</p>
                    <p><strong>Kategorija:</strong> ${category}</p>
                    <p><strong>Iznos:</strong> ${amount} RSD</p>
                    <p><strong>Opis:</strong> ${description}</p>
                </div>
                <button onclick="removeExpense(this)" class="remove-expense">&times;</button>
            `;

            expensesList.appendChild(expenseItem);

            // Calculate total expenses
            const total = Array.from(expensesList.children)
                .reduce((sum, item) => sum + parseFloat(item.querySelector('.expense-details p:nth-child(3)').textContent.split(' ')[1]), 0);
            
            totalExpenses.textContent = `Ukupni troškovi: ${total} RSD`;
        }

        function removeExpense(button) {
            const expenseItem = button.parentElement;
            expenseItem.remove();
            
            const expensesList = document.querySelector('.expenses-list');
            const totalExpenses = document.querySelector('.total-expenses');
            
            const total = Array.from(expensesList.children)
                .reduce((sum, item) => sum + parseFloat(item.querySelector('.expense-details p:nth-child(3)').textContent.split(' ')[1]), 0);
            
            totalExpenses.textContent = `Ukupni troškovi: ${total} RSD`;
        }

        // Investment calculator functionality
        function calculateInvestment() {
            const period = parseFloat(document.getElementById('investmentPeriod').value);
            const annualDeposit = parseFloat(document.getElementById('annualDeposit').value);
            
            if (!period || !annualDeposit) return;

            // Constants
            const annualRate = 0.07; // 7% annual rate
            const n = 12; // Compounded monthly
            const totalMonths = period * 12;

            // Arrays to store monthly values for chart
            const monthlyDeposits = [];
            const monthlyReturns = [];
            let totalInvestment = 0;
            let monthlyBalance = 0;
            
            for (let i = 0; i < totalMonths; i++) {
                // Add monthly deposit
                monthlyBalance += annualDeposit / 12;
                
                // Apply monthly interest
                monthlyBalance *= (1 + annualRate/12);
                
                // Store values for chart
                monthlyDeposits.push(monthlyBalance);
                monthlyReturns.push(monthlyBalance);
                
                // Update total investment at end of each year
                if ((i + 1) % 12 === 0) {
                    totalInvestment = monthlyBalance;
                }
            }

            // Calculate final results using compound interest formula
            const totalInvested = (annualDeposit * period).toFixed(2);
            const finalReturn = totalInvestment.toFixed(2);
            const totalProfit = (parseFloat(finalReturn) - parseFloat(totalInvested)).toFixed(2);
            const compoundInterest = (parseFloat(finalReturn) - parseFloat(totalInvested) - (annualDeposit * period)).toFixed(2);

            // Format numbers with thousand separators and 2 decimal places
            const formatNumber = (num) => {
                return parseFloat(num).toLocaleString('de-DE', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).replace(/\./g, 'X').replace(/,/g, '.').replace(/X/g, ',');
            };
            
            // Update result display
            const resultDiv = document.getElementById('investmentResult');
            resultDiv.style.display = 'block';
            
            document.getElementById('totalInvested').textContent = formatNumber(totalInvested) + ' RSD';
            document.getElementById('totalReturn').textContent = formatNumber(finalReturn) + ' RSD';
            document.getElementById('totalProfit').textContent = formatNumber(totalProfit) + ' RSD';

            // Hide form elements
            const formElements = document.querySelectorAll('.form-group, .note, button');
            formElements.forEach(element => {
                element.style.display = 'none';
            });

            // Prepare data for chart
            const cumulativeDeposits = [];
            const annualTotals = [];
            const labels = [];
            let totalDeposits = 0;
            
            for (let year = 0; year < period; year++) {
                const yearStart = year * 12;
                const yearEnd = (year + 1) * 12 - 1;
                
                // Add annual deposit to total
                totalDeposits += annualDeposit;
                cumulativeDeposits.push(totalDeposits);
                
                // Calculate total for the year (deposit + interest)
                const totalForYear = monthlyReturns[yearEnd];
                annualTotals.push(totalForYear);
                
                labels.push(`Godina ${year + 1}`);
            }

            // Create chart
            const ctx = document.getElementById('investmentChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Ukupno uplaćeno (RSD)',
                            data: cumulativeDeposits,
                            borderColor: '#3b82f6',
                            backgroundColor: '#3b82f6',
                            fill: false,
                            tension: 0.1,
                            order: 2,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointStyle: 'circle'
                        },
                        {
                            label: 'Uplata + Kamata (RSD)',
                            data: annualTotals,
                            borderColor: '#22c55e',
                            backgroundColor: '#22c55e',
                            fill: false,
                            tension: 0.1,
                            order: 1,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            pointStyle: 'circle'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Iznos (RSD)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('sr-RS', { style: 'currency', currency: 'RSD' }).format(value);
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Godine'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                boxWidth: 12
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const formatted = value.toLocaleString('de-DE', {
                                        minimumFractionDigits: 2,
                                        maximumFractionDigits: 2
                                    }).replace(/\./g, 'X').replace(/,/g, '.').replace(/X/g, ',');
                                    return context.dataset.label + ': ' + formatted + ' RSD';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Chat functionality

        // Initialize chat when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for budget tracking button
            const budgetTrackingBtn = document.getElementById('budgetTrackingBtn');
            if (budgetTrackingBtn) {
                budgetTrackingBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Check if user is logged in
                    const isLoggedIn = localStorage.getItem('isLoggedIn');
                    if (isLoggedIn === 'true') {
                        // Redirect to profile page where budget tracking is available
                        window.location.href = 'profile.html';
                    } else {
                        // Show login modal if not logged in
                        const loginModal = document.getElementById('loginModal');
                        if (loginModal) {
                            loginModal.style.display = 'flex';
                        }
                    }
                });
            }
            // Chat elements
            const chatContainer = document.getElementById('chatContainer');
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const closeChat = document.getElementById('closeChat');
            const supportBtn = document.getElementById('supportBtn');
            
            // Baza znanja za odgovore u chatu
            const knowledgeBase = {
                budžet: {
                    keywords: ['budžet', 'budzet', 'proračun', 'trošenje', 'troškovi', 'postavim budžet', 'kako da'],
                    response: `Za postavljanje budžeta, pratite ove korake:<br><br>
                    1. Idite na stranicu "Moj Profil"<br>
                    2. Kliknite na tab "Pregled Budžeta"<br>
                    3. Unesite vaš mesečni prihod<br>
                    4. Prilagodite procenat za svaku kategoriju potrošnje<br>
                    5. Kliknite na "Izračunaj budžet"<br><br>
                    Nakon toga možete pratiti svoje troškove i štednju u svakoj kategoriji.`
                },
                prijava: {
                    keywords: ['prijava', 'login', 'problema', 'ne mogu', 'lozinka', 'password', 'zaboravljena'],
                    response: `Ako imate problema sa prijavom, probajte sledeće:<br><br>
                    1. Proverite da li je vaša email adresa ispravno unesena<br>
                    2. Proverite da li je Caps Lock uključen<br>
                    3. Koristite opciju "Zaboravili ste lozinku?" za resetovanje<br>
                    4. Očistite keš memoriju vašeg pretraživača<br><br>
                    Ako i dalje imate problema, molimo kontaktirajte nas na info@goldenbalance.com`
                },
                investiranje: {
                    keywords: ['investiranje', 'ulaganje', 'investicija', 'štednja', 'fond', 'akcije', 'berza', 'savet'],
                    response: `Savet za investiranje:<br><br>
                    1. Počnite sa hitnim fondom štednje (3-6 mesečnih troškova)<br>
                    2. Iskoristite naš kalkulator investicija da vidite projekcije<br>
                    3. Razmotrite diversifikaciju vaših investicija<br>
                    4. Za početnike, indeksni fondovi su često najbolja opcija<br><br>
                    Preporučujemo konsultaciju sa finansijskim savetnikom za personalizovani plan.`
                },
                default: {
                    response: `Zdravo! Ja sam vaš finansijski asistent. Mogu vam pomoći sa pitanjima o:
                    <br>- Upravljanju budžetom
                    <br>- Rešavanju problema sa prijavom
                    <br>- Osnovnim savetima za investiranje
                    <br>- Korišćenju aplikacije
                    <br><br>Kako vam mogu pomoći danas?`
                }
            };
            
            // Funkcija za pronalaženje odgovora u bazi znanja
            function findAnswer(question) {
                question = question.toLowerCase();
                
                // Proveri svaku kategoriju u bazi znanja
                for (const category in knowledgeBase) {
                    if (category === 'default') continue;
                    
                    // Proveri da li pitanje sadrži neku od ključnih reči
                    const keywords = knowledgeBase[category].keywords;
                    const found = keywords.some(keyword => question.includes(keyword.toLowerCase()));
                    
                    if (found) {
                        return {
                            response: knowledgeBase[category].response,
                            isDefault: false
                        };
                    }
                }
                
                // Ako nije pronađen odgovor, vrati null
                return null;
            }
            
            // Funkcija za prikazivanje predloženih pitanja
            function showSuggestedQuestions() {
                if (!chatMessages) return;
                chatMessages.innerHTML = '';
                const welcomeMessage = document.createElement('div');
                welcomeMessage.classList.add('message', 'bot-message');
                welcomeMessage.innerHTML = knowledgeBase.default.response;
                chatMessages.appendChild(welcomeMessage);
                const suggestions = ['Kako da postavim budžet?', 'Imam problem sa prijavom', 'Saveti za investiranje'];
                const suggestionsContainer = document.createElement('div');
                suggestionsContainer.classList.add('suggestions-container');
                suggestions.forEach(suggestion => {
                    const suggestionElement = document.createElement('div');
                    suggestionElement.classList.add('suggestion');
                    suggestionElement.textContent = suggestion;
                    suggestionElement.onclick = () => sendMessage(suggestion);
                    suggestionsContainer.appendChild(suggestionElement);
                });
                chatMessages.appendChild(suggestionsContainer);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funkcija za čuvanje neodgovorenog pitanja u localStorage
            function saveUnansweredQuestion(question, email = '', phone = 'Nije naveden') {
                // Proveri da li već postoje sačuvana pitanja
                const savedQuestions = JSON.parse(localStorage.getItem('unansweredQuestions') || '[]');
                
                // Dodaj novo pitanje
                const newQuestion = {
                    id: Date.now(),
                    question: question,
                    email: email || 'Nije naveden',
                    phone: phone || 'Nije naveden',
                    timestamp: new Date().toISOString(),
                    status: 'new' // Može biti 'new', 'in_progress', 'resolved'
                };
                
                // Dodaj novo pitanje na početak niza
                savedQuestions.unshift(newQuestion);
                
                // Sačuvaj u localStorage
                localStorage.setItem('unansweredQuestions', JSON.stringify(savedQuestions));
                
                // Event koji će obavestiti admin stranicu o novom pitanju
                window.dispatchEvent(new Event('unansweredQuestionAdded'));
                
                return newQuestion.id; // Vraćamo ID za referencu ako je potrebno
            }
            
            // Funkcija za prikazivanje kontakt forme
            function showContactForm(question) {
                // Sačuvaj pitanje u privremenu promenljivu
                window.currentQuestion = question;
                
                // Kreiraj HTML za kontakt formu
                const contactFormHTML = `
                    <div class="contact-form">
                        <p>Nažalost, trenutno nemam odgovor na vaše pitanje. Da biste dobili pomoć, molimo unesite sledeće podatke i naš broker će vas kontaktirati u najkraćem mogućem roku.</p>
                        <div class="form-group">
                            <label for="contactEmail">Vaša email adresa:</label>
                            <input type="email" id="contactEmail" class="form-control" placeholder="unesite@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="contactPhone">Broj telefona (opciono):</label>
                            <input type="tel" id="contactPhone" class="form-control" placeholder="+381 6x xxx xxxx">
                        </div>
                        <button id="submitContactForm" class="btn btn-primary">Pošalji zahtev</button>
                    </div>
                `;
                
                // Dodaj formu u chat
                const botMessageElement = document.createElement('div');
                botMessageElement.classList.add('message', 'bot-message');
                botMessageElement.innerHTML = contactFormHTML;
                chatMessages.appendChild(botMessageElement);
                
                // Dodaj event listener za dugme za slanje
                setTimeout(() => {
                    const submitBtn = document.getElementById('submitContactForm');
                    if (submitBtn) {
                        submitBtn.addEventListener('click', submitContactForm);
                    }
                }, 100);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funkcija za slanje kontakt podataka
            function submitContactForm() {
                const email = document.getElementById('contactEmail')?.value.trim();
                const phone = document.getElementById('contactPhone')?.value.trim() || 'Nije naveden';
                const question = window.currentQuestion || 'Nije navedeno pitanje';
                
                if (!email) {
                    alert('Molimo unesite vašu email adresu.');
                    return;
                }
                
                // Sačuvaj pitanje
                const questionId = saveUnansweredQuestion(question, email, phone);
                
                // Prikaži poruku o uspehu
                const successMessage = document.createElement('div');
                successMessage.classList.add('message', 'bot-message');
                successMessage.innerHTML = `
                    <p>Hvala vam! Vaš upit je uspešno poslat. Broj vašeg tiket-a je: <strong>#${questionId}</strong></p>
                    <p>Naš tim će vam se obratiti u najkraćem mogućem roku na email adresu: <strong>${email}</strong></p>
                    <p>Hvala na strpljenju!</p>
                `;
                
                // Zameni formu porukom o uspehu
                const contactForm = document.querySelector('.contact-form');
                if (contactForm) {
                    contactForm.replaceWith(successMessage);
                } else {
                    chatMessages.appendChild(successMessage);
                }
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funkcija za slanje poruke
            function sendMessage(suggestedMessage) {
                const messageText = suggestedMessage || (userInput ? userInput.value.trim() : '');
                
                if (!messageText) return;
                
                // Clear input
                if (!suggestedMessage && userInput) {
                    userInput.value = '';
                }
                
                // Create user message element
                const userMessageElement = document.createElement('div');
                userMessageElement.classList.add('message', 'user-message');
                userMessageElement.textContent = messageText;
                
                // Add user message to chat
                if (chatMessages) {
                    chatMessages.appendChild(userMessageElement);
                    
                    // Show typing indicator
                    const typingIndicator = document.createElement('div');
                    typingIndicator.classList.add('message', 'bot-message', 'typing');
                    typingIndicator.textContent = 'Kucam...';
                    chatMessages.appendChild(typingIndicator);
                    
                    // Scroll to bottom
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Simulate bot response
                    setTimeout(() => {
                        // Remove typing indicator
                        chatMessages.removeChild(typingIndicator);
                        
                        // Find answer in knowledge base
                        const answer = findAnswer(messageText);
                        
                        // Create bot message element
                        const botMessageElement = document.createElement('div');
                        botMessageElement.classList.add('message', 'bot-message');
                        
                        if (answer) {
                            // If answer is found in knowledge base
                            botMessageElement.innerHTML = answer.response;
                            
                            // Add helpful buttons
                            const buttonsHTML = `
                                <div class="chat-suggestion-buttons">
                                    <button class="suggestion-btn" data-question="Da, hvala!">Da, hvala!</button>
                                    <button class="suggestion-btn" data-question="Ne, imam još pitanja">Ne, imam još pitanja</button>
                                </div>
                            `;
                            
                            botMessageElement.innerHTML += buttonsHTML;
                            
                            // Add event listeners to buttons
                            setTimeout(() => {
                                document.querySelectorAll('.suggestion-btn').forEach(btn => {
                                    btn.addEventListener('click', (e) => {
                                        const question = e.target.getAttribute('data-question');
                                        sendMessage(question);
                                    });
                                });
                            }, 100);
                        } else {
                            // If no answer found, show contact form
                            showContactForm(messageText);
                        }
                        
                        // Add bot message to chat
                        chatMessages.appendChild(botMessageElement);
                        
                        // Scroll to bottom
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                        
                    }, 1500); // Simulate typing delay
                }
            }

            // Show chat when support button is clicked
            if (supportBtn) {
                supportBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (chatContainer.style.display === 'block') {
                        closeChatFunction();
                        return;
                    }
                    chatContainer.style.display = 'block';
                    setTimeout(() => {
                        chatContainer.style.opacity = '1';
                        chatContainer.style.transform = 'translateY(0)';
                        showSuggestedQuestions();
                        if (userInput) userInput.focus();
                    }, 10);
                });
            }

            // Close chat function
            function closeChatFunction() {
                if (chatContainer) {
                    chatContainer.style.opacity = '0';
                    chatContainer.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        chatContainer.style.display = 'none';
                    }, 300);
                }
            }


            // Close chat when clicking the close button
            if (closeChat) {
                closeChat.addEventListener('click', closeChatFunction);
            }


            // Send message on button click
            if (sendButton) {
                sendButton.addEventListener('click', () => sendMessage());
            }


            // Send message on Enter key
            if (userInput) {
                userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const messageText = userInput.value.trim();
                        if (messageText) {
                            sendMessage(messageText);
                            userInput.value = ''; // Clear input after sending
                        }
                    }
                });
            }
        });

        // Add styles for new elements
        const style = document.createElement('style');
        style.textContent = `
            .form-group {
                margin-bottom: 1rem;
            }
            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 500;
            }
            .form-group input, .form-group select {
                width: 100%;
            }
            .expense-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem;
                border: 1px solid #e2e8f0;
                border-radius: var(--border-radius);
                margin-bottom: 0.5rem;
            }
            .remove-expense {
                background: none;
                border: none;
                font-size: 1.25rem;
                cursor: pointer;
                color: #dc2626;
            }
            .chat-container {
                height: 400px;
                display: flex;
                flex-direction: column;
            }
            .chat-messages {
                flex-grow: 1;
                overflow-y: auto;
                padding: 15px;
            }
            .chat-input {
                padding: 1rem;
                display: flex;
                gap: 0.5rem;
            }
            .chat-input input {
                flex-grow: 1;
            }
            .user-message {
                background-color: var(--primary-color);
                color: white;
                padding: 0.75rem;
                border-radius: 0.5rem;
                margin-bottom: 0.5rem;
            }
            .ai-message {
                background-color: #f3f4f6;
                padding: 0.75rem;
                border-radius: 0.5rem;
                margin-bottom: 0.5rem;
            }
        `;
        document.head.appendChild(style);
    </script>
    <!-- Loan Calculator Form -->
    <div class="modal" id="loanCalculatorModal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="form-header">
                <h2><i class="fas fa-chart-line"></i> Investicioni kalkulator - S&P 500</h2>
                <p>Izračunajte potencijalni rast vaše investicije u S&P 500 indeksni fond (prosečni godišnji povrat 7%)</p>
            </div>
            
            <form id="loanForm" class="loan-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="loanAmount">Početna investicija (RSD)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-money-bill-wave"></i>
                            <input type="number" id="loanAmount" min="10000" step="10000" value="500000" required>
                        </div>
                        <div class="range-container">
                            <input type="range" id="loanAmountRange" min="10000" max="10000000" step="10000" value="500000" class="slider">
                            <div class="range-labels">
                                <span>10.000 RSD</span>
                                <span>10.000.000 RSD</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loanTerm">Period investiranja (godine)</label>
                        <div class="input-with-icon">
                            <i class="far fa-calendar-alt"></i>
                            <input type="number" id="loanTerm" min="1" max="40" value="10" required>
                        </div>
                        <div class="range-container">
                            <input type="range" id="loanTermRange" min="1" max="40" value="10" class="slider">
                            <div class="range-labels">
                                <span>1 godina</span>
                                <span>40 godina</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="yearlyContribution">Godišnja uplata (RSD)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-coins"></i>
                            <input type="number" id="yearlyContribution" min="0" max="1000000" step="10000" value="100000" required>
                        </div>
                        <div class="range-container">
                            <input type="range" id="yearlyContributionRange" min="0" max="1000000" step="10000" value="100000" class="slider">
                            <div class="range-labels">
                                <span>0 RSD</span>
                                <span>1.000.000 RSD</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-redo"></i> Poništi
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-calculator"></i> Izračunaj
                    </button>
                </div>
            </form>
            
            <div id="results" class="results-container">
                <h3>Rezultati investiranja</h3>
                <div class="results-grid">
                    <div class="result-item">
                        <div class="result-label">Početna investicija:</div>
                        <div class="result-value" id="initialInvestment">-</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Ukupno uloženo:</div>
                        <div class="result-value" id="totalContributed">-</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Ukupan povrat:</div>
                        <div class="result-value">
                            <span id="totalReturnValue">-</span>
                            <br>
                            <span id="roiValue" style="color: #10b981; font-size: 0.9em; font-weight: bold;">ROI: 0,00%</span>
                        </div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Konačna vrednost:</div>
                        <div class="result-value" id="finalValue">-</div>
                    </div>
                </div>
                <div class="chart-container" style="margin-top: 20px; background-color: #f8fafc; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin-top: 0; margin-bottom: 15px; color: #334155;">Rast investicije kroz godine</h4>
                    <div id="investmentChartSimple" style="width: 100%; min-height: 350px; display: flex; flex-direction: column;">
                        <div style="display: flex; justify-content: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: center; margin-right: 20px;">
                                <span style="display: inline-block; width: 15px; height: 15px; background-color: #1976d2; margin-right: 8px;"></span>
                                <span>Ukupno uloženo</span>
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span style="display: inline-block; width: 15px; height: 15px; background-color: #2ecc71; margin-right: 8px;"></span>
                                <span>Prinos investicije</span>
                            </div>
                        </div>
                        
                        <div id="graphContainer" style="display: flex; height: 280px; border-bottom: 1px solid #ccc; padding-bottom: 20px; margin-bottom: 10px; overflow-x: auto;">
                            <!-- Ovde će se generisati grafikon kroz JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="printResults()">
                        <i class="fas fa-print"></i> Štampaj rezultate
                    </button>
                    <button type="button" class="btn btn-primary" onclick="learnMoreInvestment()">
                        <i class="fas fa-book"></i> Saznajte više o investiranju
                    </button>
                    <button type="button" class="btn btn-success" onclick="resetForm()">
                        <i class="fas fa-redo"></i> Novi proračun
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Chat Interface -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3><i class="fas fa-headset"></i> Tehnička Podrška</h3>
            <button class="close-chat" id="closeChat">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                Zdravo! Ja sam vaš finansijski asistent. Kako vam mogu pomoći danas?</div>
            <div class="message bot-message" style="margin-top: 8px;">
                <i class="fas fa-info-circle"></i> Ovo je chat za direktnu komunikaciju sa našim timom. Ovde možete postaviti pitanja o aplikaciji, finansijama ili zatražiti pomoć.</div>
            <div class="chat-suggestion-buttons">
                <button class="chat-suggestion" onclick="sendMessage('Kako da postavim budžet?')">Kako da postavim budžet?</button>
                <button class="chat-suggestion" onclick="sendMessage('Imam problema sa prijavom')">Problem sa prijavom</button>
                <button class="chat-suggestion" onclick="sendMessage('Želim savet za investiranje')">Savet za investiranje</button>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Postavite pitanje...">
            <button class="send-button" id="sendMessage">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <style>
        /* Chat Styles */
        .typing {
            color: #888;
            font-style: italic;
        }
        
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 380px;
            height: 500px;
            max-height: 80vh;
            background: rgba(22, 22, 26, 0.98);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none; /* Početno sakriven */
            flex-direction: column;
            overflow: hidden;
            z-index: 10000; /* Veći z-index da bude iznad svih elemenata */
            border: 1px solid var(--border-light);
            backdrop-filter: blur(10px);
            transform: translateY(20px);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: auto;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--gradient-gold);
            color: var(--dark-bg);
            font-weight: 600;
        }
        
        .chat-header h3 {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-chat {
            background: rgba(0, 0, 0, 0.2);
            border: none;
            border-radius: 50%;
            color: var(--dark-bg);
            cursor: pointer;
            font-size: 1rem;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 0;
            margin: 0;
            position: relative;
            z-index: 10001;
        }
        
        .close-chat:hover {
            background: rgba(0, 0, 0, 0.4);
            transform: rotate(90deg);
        }
        
        .close-chat:focus {
            outline: 2px solid var(--gold-bright);
            outline-offset: 2px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(180deg, rgba(14, 14, 16, 0.7), rgba(16, 16, 18, 0.8));
        }
        
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            word-break: break-word;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.3);
            color: var(--light-text);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background: rgba(212, 175, 55, 0.5);
            color: var(--dark-bg);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .chat-input {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(22, 22, 26, 0.8);
            border-top: 1px solid var(--border-light);
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-light);
            border-radius: 25px;
            background: rgba(30, 30, 35, 0.8);
            color: var(--light-text);
            font-size: 0.95rem;
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--gold-medium);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }
        
        .chat-input input::placeholder {
            color: var(--muted-text);
        }
        
        .send-button {
            background: var(--gradient-gold);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--dark-bg);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
        }
        
        /* Chat suggestion buttons */
        .chat-suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        
        .chat-suggestion {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 18px;
            padding: 8px 15px;
            font-size: 0.9rem;
            color: var(--light-text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .chat-suggestion:hover {
            background: rgba(212, 175, 55, 0.3);
            transform: translateY(-2px);
        }
        
        /* Loan Calculator Styles */
        .form-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .form-header h2 {
            color: #2563eb;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .form-header p {
            color: #64748b;
            margin: 0;
        }
        
        .loan-form {
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-step {
            display: none;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-description {
            color: #64748b;
            margin-top: 0.5rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        
        .input-with-icon input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .goal-card {
            transition: all 0.2s ease;
        }
        
        .goal-card.selected {
            border-color: #3b82f6 !important;
            background-color: #f8fafc;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .goal-card i {
            transition: all 0.2s ease;
        }
        
        .goal-card.selected i {
            transform: scale(1.1);
        }
        
        .form-actions {
            margin-top: 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            font-family: inherit;
            font-size: 1rem;
        }
        
        .btn i {
            font-size: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #2563eb, #1d4ed8);
            color: white;
            border-color: #2563eb;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #2563eb, #1d4ed8);
            border-color: #2563eb;
        }
        
        .btn-outline {
            background: #f1f5f9;
            color: #334155;
            border: 1px solid #e2e8f0;
        }
        
        .btn-outline:hover {
            background: #e2e8f0;
        }
        
        .results-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .results-container h3 {
            margin-top: 0;
            margin-bottom: 1.5rem;
            color: #1e293b;
            text-align: center;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .result-item {
            background: white;
            padding: 1.25rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .result-label {
            font-size: 0.875rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        
        .result-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Modal funkcije
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                document.body.classList.add('modal-open');
                
                // Focus first input if exists
                const firstInput = modal.querySelector('input:not([type="hidden"]), select, textarea');
                if (firstInput) {
                    setTimeout(() => firstInput.focus(), 100);
                }
            }
        }
        
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            document.body.classList.remove('modal-open');
        }
        
        // S&P 500 Investment Calculator Functionality (7% godišnji prinos)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize form elements
            const loanForm = document.getElementById('loanForm');
            const loanAmount = document.getElementById('loanAmount');
            const loanAmountRange = document.getElementById('loanAmountRange');
            const loanTerm = document.getElementById('loanTerm');
            const loanTermRange = document.getElementById('loanTermRange');
            const yearlyContribution = document.getElementById('yearlyContribution');
            const yearlyContributionRange = document.getElementById('yearlyContributionRange');
            
            // Definisanje fiksne stope prinosa (S&P 500 prosečan prinos 7%)
            const ANNUAL_RETURN_RATE = 0.07;
            
            // Chart instance
            let investmentChart = null;
            
            // Sync range inputs with number inputs
            loanAmount.addEventListener('input', () => {
                loanAmountRange.value = loanAmount.value;
                calculateInvestment();
            });
            
            loanAmountRange.addEventListener('input', () => {
                loanAmount.value = loanAmountRange.value;
                calculateInvestment();
            });
            
            loanTerm.addEventListener('input', () => {
                loanTermRange.value = loanTerm.value;
                calculateInvestment();
            });
            
            loanTermRange.addEventListener('input', () => {
                loanTerm.value = loanTermRange.value;
                calculateInvestment();
            });
            
            yearlyContribution.addEventListener('input', () => {
                yearlyContributionRange.value = yearlyContribution.value;
                calculateInvestment();
            });
            
            yearlyContributionRange.addEventListener('input', () => {
                yearlyContribution.value = yearlyContributionRange.value;
                calculateInvestment();
            });
            
            // Form submission
            loanForm.addEventListener('submit', function(e) {
                e.preventDefault();
                calculateInvestment(true);
            });
            
            // Inicijalno izračunavanje - prikaži podrazumevane vrednosti
            function calculateInitialValues() {
                // Dobavljanje trenutnih vrednosti iz inputa
                const initialAmount = parseFloat(loanAmount.value) || 500000;
                const years = parseInt(loanTerm.value) || 20;
                const yearlyAmount = parseFloat(yearlyContribution.value) || 75000;
                
                // Izvrši izračun
                let currentValue = initialAmount;
                let totalContributed = initialAmount;
                
                // Izračunavanje za svaku godinu
                for (let year = 1; year <= years; year++) {
                    // Dodavanje godišnjeg doprinosa
                    currentValue += yearlyAmount;
                    totalContributed += yearlyAmount;
                    
                    // Dodavanje godišnjeg prinosa
                    currentValue *= (1 + ANNUAL_RETURN_RATE);
                }
                
                // Izračunavanje povrata i ROI
                const totalReturn = currentValue - totalContributed;
                const roi = (totalReturn / totalContributed) * 100;
                
                // Formatiranje brojeva za prikaz
                document.getElementById('initialInvestment').textContent = formatCurrency(initialAmount);
                document.getElementById('totalContributed').textContent = formatCurrency(totalContributed);
                document.getElementById('totalReturn').innerHTML = formatCurrency(totalReturn) + 
                    `<br><span style="color: #10b981; font-size: 0.9em; font-weight: bold;">ROI: ${roi.toFixed(2)}%</span>`;
                document.getElementById('finalValue').textContent = formatCurrency(currentValue);
            }
            
            calculateInitialValues();
            
            // Function to calculate investment growth
            function calculateInvestment(showResults = false) {
                const initialAmount = parseFloat(loanAmount.value) || 500000;
                const years = parseInt(loanTerm.value) || 20;
                const yearlyAmount = parseFloat(yearlyContribution.value) || 75000;
                
                // Niz za praćenje rasta investicije po godinama
                let yearlyData = [];
                let currentValue = initialAmount;
                
                // Početna vrednost ulaganja
                yearlyData.push({
                    year: 0,
                    invested: initialAmount,
                    value: initialAmount,
                    return: 0
                });
                
                // Izračunavanje za svaku godinu
                for (let year = 1; year <= years; year++) {
                    // Dodavanje godišnjeg doprinosa
                    currentValue += yearlyAmount;
                    
                    // Dodavanje godišnjeg prinosa
                    currentValue *= (1 + ANNUAL_RETURN_RATE);
                    
                    // Ukupno uloženo do sada
                    const totalInvested = initialAmount + (yearlyAmount * year);
                    
                    // Dodavanje podataka za godinu
                    yearlyData.push({
                        year: year,
                        invested: totalInvested,
                        value: currentValue,
                        return: currentValue - totalInvested
                    });
                }
                
                // Ukupno investirano
                const totalContributed = initialAmount + (yearlyAmount * years);
                
                // Izračunavanje ROI (Return on Investment)
                const totalReturn = currentValue - totalContributed;
                const roi = (totalReturn / totalContributed) * 100;
                
                console.log('Izračunavanje:', {
                    initialAmount,
                    years,
                    yearlyAmount,
                    currentValue,
                    totalContributed,
                    totalReturn,
                    roi: roi.toFixed(2) + '%'
                });
                
                // Prikaz rezultata
                if (showResults) {
                    // Formatiranje brojeva za prikaz
                    document.getElementById('initialInvestment').textContent = formatCurrency(initialAmount);
                    document.getElementById('totalContributed').textContent = formatCurrency(totalContributed);
                    document.getElementById('finalValue').textContent = formatCurrency(currentValue);
                    
                    // Postavljanje povrata i ROI-a koristeći nove elemente
                    document.getElementById('totalReturnValue').textContent = formatCurrency(totalReturn);
                    document.getElementById('roiValue').textContent = `ROI: ${roi.toFixed(2).replace('.', ',')}%`;
                    
                    // Sakrivanje forme i prikaz samo grafikona i rezultata
                    loanForm.style.display = 'none';
                    const resultsContainer = document.getElementById('results');
                    resultsContainer.style.display = 'block';
                    
                    // Forsiranje reflow-a za bolji prikaz grafikona
                    setTimeout(() => {
                        window.dispatchEvent(new Event('resize'));
                    }, 10);
                    
                    // Kreiranje grafikona sa proverom Chart.js biblioteke
                    setTimeout(() => {
                        if (typeof Chart !== 'undefined') {
                            createInvestmentChart(yearlyData);
                        } else {
                            console.error('Chart.js biblioteka nije učitana! Pokušavamo ponovo učitati...');
                            loadChartJS(() => createInvestmentChart(yearlyData));
                        }
                    }, 300);
                }
            }
            
            // Kreiranje HTML grafikona investicije
            function createInvestmentChart(data) {
                console.log('Kreiranje HTML grafikona investicije...', data);
                
                // Proveravamo da li je kontejner dostupan
                const graphContainer = document.getElementById('graphContainer');
                if (!graphContainer) {
                    console.error('Kontejner za grafikon nije pronađen!');
                    return;
                }
                
                // Brišemo prethodni sadržaj
                graphContainer.innerHTML = '';
                
                // Filtriramo samo relevantne godine (preskacemo nultu godinu i ostavljamo samo godinu 1+)
                const relevantData = data.filter(item => item.year > 0);
                
                // Nalazimo maksimalnu vrednost za skaliranje
                const maxValue = Math.max(...relevantData.map(item => item.value));
                
                // Kreiramo vizuelni prikaz za svaku godinu
                relevantData.forEach(item => {
                    const yearContainer = document.createElement('div');
                    yearContainer.style.display = 'flex';
                    yearContainer.style.flexDirection = 'column';
                    yearContainer.style.alignItems = 'center';
                    yearContainer.style.minWidth = '80px';
                    yearContainer.style.flex = '1';
                    yearContainer.style.marginRight = '10px';
                    
                    // Bar graf
                    const barContainer = document.createElement('div');
                    barContainer.style.display = 'flex';
                    barContainer.style.flexDirection = 'column-reverse';
                    barContainer.style.width = '60px';
                    barContainer.style.height = '100%';
                    barContainer.style.position = 'relative';
                    
                    // Izračunavamo visinu za investirani deo i prinos kao procenat maksimalne vrednosti
                    const investedHeight = (item.invested / maxValue) * 100;
                    const returnHeight = (item.return / maxValue) * 100;
                    
                    // Dodajemo deo za uloženo
                    const investedBar = document.createElement('div');
                    investedBar.style.height = `${investedHeight}%`;
                    investedBar.style.backgroundColor = '#1976d2';
                    investedBar.style.width = '100%';
                    investedBar.style.borderTopLeftRadius = '4px';
                    investedBar.style.borderTopRightRadius = '4px';
                    investedBar.style.position = 'relative';
                    investedBar.title = `Uloženo: ${formatCurrency(item.invested)}`;
                    barContainer.appendChild(investedBar);
                    
                    // Dodajemo deo za prinos
                    if (item.return > 0) {
                        const returnBar = document.createElement('div');
                        returnBar.style.height = `${returnHeight}%`;
                        returnBar.style.backgroundColor = '#2ecc71';
                        returnBar.style.width = '100%';
                        returnBar.style.borderTopLeftRadius = '4px';
                        returnBar.style.borderTopRightRadius = '4px';
                        returnBar.style.position = 'absolute';
                        returnBar.style.bottom = `${investedHeight}%`;
                        returnBar.style.left = '0';
                        
                        // Izračunavamo ROI
                        const roi = (item.return / item.invested) * 100;
                        returnBar.title = `Prinos: ${formatCurrency(item.return)} (ROI: ${roi.toFixed(2)}%)`;
                        barContainer.appendChild(returnBar);
                    }
                    
                    yearContainer.appendChild(barContainer);
                    
                    // Dodajemo oznaku godine
                    const yearLabel = document.createElement('div');
                    yearLabel.textContent = `Godina ${item.year}`;
                    yearLabel.style.marginTop = '8px';
                    yearLabel.style.fontWeight = 'bold';
                    yearLabel.style.fontSize = '12px';
                    yearContainer.appendChild(yearLabel);
                    
                    // Dodajemo vrednost
                    const valueLabel = document.createElement('div');
                    valueLabel.textContent = formatCurrency(item.value, false);
                    valueLabel.style.marginTop = '4px';
                    valueLabel.style.fontSize = '11px';
                    yearContainer.appendChild(valueLabel);
                    
                    graphContainer.appendChild(yearContainer);
                });
                
                // Dodajemo liniju koja predstavlja rast investicije
                const svgContainer = document.createElement('div');
                svgContainer.style.position = 'absolute';
                svgContainer.style.top = '0';
                svgContainer.style.left = '0';
                svgContainer.style.width = '100%';
                svgContainer.style.height = '100%';
                svgContainer.style.pointerEvents = 'none';
                
                // Dodajemo poruku ako nema podataka
                if (relevantData.length === 0) {
                    const noDataMsg = document.createElement('div');
                    noDataMsg.textContent = 'Nema podataka za prikaz. Izračunajte investiciju.';
                    graphContainer.appendChild(noDataMsg);
                }
            }
            
            // Formatiranje valute
            function formatCurrency(value, includeCurrency = true) {
                const formatter = new Intl.NumberFormat('sr-RS', {
                    style: includeCurrency ? 'currency' : 'decimal',
                    currency: 'RSD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
                return formatter.format(value);
            }
            
            // Resetovanje forme
            window.resetForm = function() {
                loanAmount.value = 500000;
                loanAmountRange.value = 500000;
                loanTerm.value = 10;
                loanTermRange.value = 10;
                yearlyContribution.value = 100000;
                yearlyContributionRange.value = 100000;
                document.getElementById('results').style.display = 'none';
                if (loanForm) loanForm.style.display = 'block';
                if (typeof calculateInvestment === 'function') calculateInvestment();
            };
            
            // Funkcija za više informacija o investiranju
            window.learnMoreInvestment = function() {
                alert('Za više informacija o investiranju u indeksne fondove poput S&P 500 i kako možete započeti, kontaktirajte naše finansijske savetnike putem korisničke podrške.');
            };
            
            // Funkcija za štampanje rezultata
            window.printResults = function() {
                window.print();
            };
            
            // Inicijalno izračunavanje
            calculateInvestment();
        });
        
        // Chat funkcionalnost je prebačena u DOMContentLoaded event listener
        
        // Funkcija za prikazivanje predloženih pitanja
function showSuggestedQuestions() {
    if (!chatMessages) return;
    chatMessages.innerHTML = '';
    const welcomeMessage = document.createElement('div');
    welcomeMessage.classList.add('message', 'bot-message');
    welcomeMessage.innerHTML = knowledgeBase.default.response;
    chatMessages.appendChild(welcomeMessage);
    const suggestions = ['Kako da postavim budžet?', 'Imam problem sa prijavom', 'Saveti za investiranje'];
    const suggestionsContainer = document.createElement('div');
    suggestionsContainer.classList.add('suggestions-container');
    suggestions.forEach(suggestion => {
        const suggestionElement = document.createElement('div');
        suggestionElement.classList.add('suggestion');
        suggestionElement.textContent = suggestion;
        suggestionElement.onclick = () => sendMessage(suggestion);
        suggestionsContainer.appendChild(suggestionElement);
    });
    chatMessages.appendChild(suggestionsContainer);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Funkcija za zatvaranje chata
function closeChatFunction() {
    if (chatContainer) {
        chatContainer.style.opacity = '0';
        chatContainer.style.transform = 'translateY(20px)';
        setTimeout(() => {
            chatContainer.style.display = 'none';
        }, 300);
    }
}

// Funkcija za pronalaženje odgovora u bazi znanja
function findAnswer(question) {
    question = question.toLowerCase();
    
    // Proveri svaku kategoriju u bazi znanja
    for (const category in knowledgeBase) {
        if (category === 'default') continue;
        
        // Proveri da li pitanje sadrži neku od ključnih reči
        const keywords = knowledgeBase[category].keywords;
        const found = keywords.some(keyword => question.includes(keyword.toLowerCase()));
        
        if (found) {
            return {
                response: knowledgeBase[category].response,
                isDefault: false
            };
        }
    }
    
    // Ako nije pronađen odgovor, vrati null
    return null;
}

// Funkcija za prikazivanje kontakt forme
function showContactForm(question) {
    // Sačuvaj pitanje u privremenu promenljivu
    window.currentQuestion = question;
    
    // Kreiraj HTML za kontakt formu
    const contactFormHTML = `
        <div class="contact-form">
            <p>Nažalost, trenutno nemam odgovor na vaše pitanje. Da biste dobili pomoć, molimo unesite sledeće podatke i naš broker će vas kontaktirati u najkraćem mogućem roku.</p>
            <div class="form-group">
                <label for="contactEmail">Vaša email adresa:</label>
                <input type="email" id="contactEmail" class="form-control" placeholder="unesite@email.com" required>
            </div>
            <div class="form-group">
                <label for="contactPhone">Broj telefona (opciono):</label>
                <input type="tel" id="contactPhone" class="form-control" placeholder="+381 6x xxx xxxx">
            </div>
            <button id="submitContactForm" class="btn btn-primary">Pošalji zahtev</button>
        </div>
    `;
    
    if (chatMessages) {
        const botMessageElement = document.createElement('div');
        botMessageElement.classList.add('message', 'bot-message');
        botMessageElement.innerHTML = contactFormHTML;
        chatMessages.appendChild(botMessageElement);
        
        // Dodaj event listener za dugme za slanje
        setTimeout(() => {
            const submitBtn = document.getElementById('submitContactForm');
            if (submitBtn) {
                submitBtn.addEventListener('click', submitContactForm);
            }
        }, 100);
    }
    
    // Scroll to bottom
    if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Funkcija za slanje kontakt podataka
function submitContactForm() {
    const email = document.getElementById('contactEmail')?.value.trim();
    const phone = document.getElementById('contactPhone')?.value.trim() || 'Nije naveden';
    const question = window.currentQuestion || 'Nije navedeno pitanje';
    
    if (!email) {
        alert('Molimo unesite vašu email adresu.');
        return;
    }
    
    // Sačuvaj pitanje
    const questionId = saveUnansweredQuestion(question, email, phone);
    
    // Prikaži poruku o uspehu
    const successMessage = document.createElement('div');
    successMessage.classList.add('message', 'bot-message');
    successMessage.innerHTML = `
        <p>Hvala vam! Vaš upit je uspešno poslat. Broj vašeg tiket-a je: <strong>#${questionId}</strong></p>
        <p>Naš tim će vam se obratiti u najkraćem mogućem roku na email adresu: <strong>${email}</strong></p>
        <p>Hvala na strpljenju!</p>
    `;
    
    // Zameni formu porukom o uspehu
    const contactForm = document.querySelector('.contact-form');
    if (contactForm) {
        contactForm.replaceWith(successMessage);
    } else if (chatMessages) {
        chatMessages.appendChild(successMessage);
    }
    
    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Funkcija za čuvanje neodgovorenog pitanja u localStorage
function saveUnansweredQuestion(question, email = '', phone = 'Nije naveden') {
    // Proveri da li već postoje sačuvana pitanja
    const savedQuestions = JSON.parse(localStorage.getItem('unansweredQuestions') || '[]');
    
    // Dodaj novo pitanje
    const newQuestion = {
        id: Date.now(),
        question: question,
        email: email || 'Nije naveden',
        phone: phone || 'Nije naveden',
        timestamp: new Date().toISOString(),
        status: 'new' // Može biti 'new', 'in_progress', 'resolved'
    };
    
    // Dodaj novo pitanje na početak niza
    savedQuestions.unshift(newQuestion);
    
    // Sačuvaj u localStorage
    localStorage.setItem('unansweredQuestions', JSON.stringify(savedQuestions));
    
    // Event koji će obavestiti admin stranicu o novom pitanju
    window.dispatchEvent(new Event('unansweredQuestionAdded'));
    
    return newQuestion.id; // Vraćamo ID za referencu ako je potrebno
}

// Baza znanja za odgovore u chatu - glavna definicija
if (typeof window.knowledgeBase === 'undefined') {
    window.knowledgeBase = {
    budžet: {
        keywords: ['budžet', 'budzet', 'proračun', 'trošenje', 'troškovi', 'postavim budžet', 'kako da'],
        response: `Za postavljanje budžeta, pratite ove korake:<br><br>
        1. Idite na stranicu "Moj Profil"<br>
        2. Kliknite na tab "Pregled Budžeta"<br>
        3. Unesite vaš mesečni prihod<br>
        4. Prilagodite procenat za svaku kategoriju potrošnje<br>
        5. Kliknite na "Izračunaj budžet"<br><br>
        Nakon toga možete pratiti svoje troškove i štednju u svakoj kategoriji.`
    },
    prijava: {
        keywords: ['prijava', 'login', 'problema', 'ne mogu', 'lozinka', 'password', 'zaboravljena'],
        response: `Ako imate problema sa prijavom, probajte sledeće:<br><br>
        1. Proverite da li je vaša email adresa ispravno unesena<br>
        2. Proverite da li je Caps Lock uključen<br>
        3. Koristite opciju "Zaboravili ste lozinku?" za resetovanje<br>
        4. Očistite keš memoriju vašeg pretraživača<br><br>
        Ako i dalje imate problema, molimo kontaktirajte nas na info@goldenbalance.com`
    },
    investiranje: {
        keywords: ['investiranje', 'ulaganje', 'investicija', 'štednja', 'fond', 'akcije', 'berza', 'savet'],
        response: `Savet za investiranje:<br><br>
        1. Počnite sa hitnim fondom štednje (3-6 mesečnih troškova)<br>
        2. Iskoristite naš kalkulator investicija da vidite projekcije<br>
        3. Razmotrite diversifikaciju vaših investicija<br>
        4. Za početnike, indeksni fondovi su često najbolja opcija<br><br>
        Preporučujemo konsultaciju sa finansijskim savetnikom za personalizovani plan.`
    },
    default: {
        response: `Zdravo! Ja sam vaš finansijski asistent. Mogu vam pomoći sa pitanjima o:
        <br>- Upravljanju budžetom
        <br>- Rešavanju problema sa prijavom
        <br>- Osnovnim savetima za investiranje
        <br>- Korišćenju aplikacije
        <br><br>Kako vam mogu pomoći danas?`
    }
};

// Funkcija za pronalaženje odgovora na osnovu pitanja
function findAnswer(question) {
    question = question.toLowerCase();

    // Provjera za ključne riječi u pitanju
    for (const category in knowledgeBase) {
        if (category === 'default') continue;

        const item = knowledgeBase[category];
        const found = item.keywords.some(keyword => question.includes(keyword));

        if (found) {
            return {
                response: item.response,
                isDefault: false
            };
        }
    }

    // Ako nema poklapanja, vrati null što označava da nije pronađen odgovor
    return null;
}

// Funkcija za prikazivanje kontakt forme
function showContactForm(question) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;
    
    const contactForm = `
        <div class="contact-form">
            <p>Nažalost, nisam siguran kako da vam pomognem sa pitanjem: "${question}"</p>
            <p>Molimo popunite sledeći formular i naš tim će vam se javiti u najkraćem mogućem roku.</p>
            <form id="supportForm">
                <input type="hidden" name="question" value="${question}">
                <div class="form-group">
                    <label for="name">Ime i prezime:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email adresa:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="message">Dodatne napomene (opciono):</label>
                    <textarea id="message" name="message" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Pošalji upit</button>
            </form>
        </div>
    `;

    const formContainer = document.createElement('div');
    formContainer.innerHTML = contactForm;
    chatMessages.appendChild(formContainer);
    
    // Dodajemo event listener za formu
    const supportForm = document.getElementById('supportForm');
    if (supportForm) {
        supportForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Simuliramo slanje podataka
            const response = document.createElement('div');
            response.classList.add('message', 'bot-message');
            response.innerHTML = 'Hvala vam na upitu! Naš tim će vam se javiti u najkraćem mogućem roku.';
            chatMessages.appendChild(response);
            
            // Brišemo formu
            formContainer.remove();
            chatMessages.scrollTop = chatMessages.scrollHeight;
        });
    }
    
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Glavna funkcija za slanje poruke
function sendMessage(suggestedMessage) {
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    
    if (!chatMessages || !userInput) return;
    
    const messageText = suggestedMessage || userInput.value.trim();
    if (!messageText) return;
    
    // Dodajemo korisnikovu poruku u chat
    const messageElement = document.createElement('div');
    messageElement.classList.add('message', 'user-message');
    messageElement.textContent = messageText;
    chatMessages.appendChild(messageElement);
    
    // Brišemo input samo ako nije predložena poruka (sugestija)
    if (!suggestedMessage) {
        userInput.value = '';
    }
    
    // Prikazujemo indikator kucanja
    const typingIndicator = document.createElement('div');
    typingIndicator.classList.add('message', 'bot-message', 'typing');
    typingIndicator.id = 'typingIndicator';
    typingIndicator.textContent = 'Pišem...';
    chatMessages.appendChild(typingIndicator);
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    // Simuliramo kašnjenje odgovora
    setTimeout(() => {
        // Uklanjamo indikator kucanja
        const indicator = document.getElementById('typingIndicator');
        if (indicator) {
            indicator.remove();
        }

        // Proveravamo da li postoji odgovor u bazi znanja
        const answer = findAnswer(messageText);

        if (answer) {
            // Ako postoji odgovor u bazi znanja, prikažemo ga
            const responseElement = document.createElement('div');
            responseElement.classList.add('message', 'bot-message');
            responseElement.innerHTML = answer.response;
            chatMessages.appendChild(responseElement);
        } else {
            // Ako ne postoji odgovor, prikažemo kontakt formu
            showContactForm(messageText);
        }

        // Skrolujemo na dno čata
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1500); // Simuliramo vreme potrebno za pisanje odgovora
}

// Initialize chat when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    const chatContainer = document.getElementById('chatContainer');
    const chatToggle = document.getElementById('chatToggle');
    const closeChat = document.getElementById('closeChat');
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendButton = document.getElementById('sendButton');

    // Function to initialize chat
    function initializeChat() {
        // Initialize event listeners
        if (sendButton) {
            sendButton.addEventListener('click', () => {
                const messageText = userInput?.value.trim();
                if (messageText) {
                    sendMessage(messageText);
                }
            });
        }


        if (userInput) {
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const messageText = userInput.value.trim();
                    if (messageText) {
                        sendMessage(messageText);
                    }
                }
            });
        }

        if (closeChat && chatContainer) {
            closeChat.addEventListener('click', () => {
                chatContainer.style.display = 'none';
            });
        }

        // Show welcome message on first load
        if (chatMessages && chatMessages.children.length === 0) {
            showWelcomeMessage(chatMessages);
        }
    }


    // Function to show welcome message
    function showWelcomeMessage(container) {
        const welcomeMessage = document.createElement('div');
        welcomeMessage.className = 'message bot-message';
        welcomeMessage.textContent = 'Dobar dan! Kako vam mogu pomoći danas?';
        container.appendChild(welcomeMessage);

        // Add quick suggestions
        const suggestions = [
            'Kako da postavim budžet?',
            'Šta je to investicioni fond?',
            'Kako da uštedim više novca?'
        ];

        const suggestionsContainer = document.createElement('div');
        suggestionsContainer.className = 'suggestions';
        
        suggestions.forEach(suggestion => {
            const button = document.createElement('button');
            button.className = 'suggestion-btn';
            button.textContent = suggestion;
            button.onclick = () => sendMessage(suggestion);
            suggestionsContainer.appendChild(button);
        });

        container.appendChild(suggestionsContainer);
        container.scrollTop = container.scrollHeight;
    }

    // Initialize the chat
    initializeChat();
});

// Baza znanja sa pitanjima i odgovorima
        function findAnswer(question) {
            const knowledgeBase = [
                {
                    keywords: ['budžet', 'postaviti budžet', 'kako postaviti budžet'],
                    response: 'Za postavljanje budžeta, idite na sekciju "Budžet" u glavnom meniju. Tamo možete uneti svoje prihode i troškove kako biste pratili svoju finansijsku situaciju.'
                },
                {
                    keywords: ['investicioni fond', 'šta je investicioni fond', 'kako funkcioniše investicioni fond'],
                    response: 'Investicioni fond je oblik kolektivnog ulaganja gde više ulagača ulaže novac u zajednički fond koji se zatim ulaže u različite finansijske instrumente. Naš tim stručnjaka će vam rado pruži detaljnije informacije o dostupnim opcijama.'
                },
                {
                    keywords: ['ušteda', 'kako uštedeti', 'štednja novca'],
                    response: 'Za uštedu novca preporučujemo da prvo pratite svoje troškove, napravite realan budžet i identificirate oblasti gde možete smanjiti troškove. Takođe možete razmotriti različite štedne programe i investicione opcije koje nudimo.'
                },
                {
                    keywords: ['kredit', 'kreditni rejting', 'kako dobiti kredit'],
                    response: 'Za informacije o kreditima i kreditnom rejtingu, posetite našu sekciju "Krediti" gde možete pronaći sve potrebne informacije i kalkulatore. Takođe možete zakažati sastanak sa našim kreditnim savetnicima.'
                },
                {
                    keywords: ['penziono osiguranje', 'štednja za penziju'],
                    response: 'Za planiranje penzije imamo različite programe štednje i investicione opcije. Posetite našu sekciju "Penziono osiguranje" ili zakažite konsultacije sa našim penzionim savetnicima.'
                }
            ];

            const lowerQuestion = question.toLowerCase();
            const foundAnswer = knowledgeBase.find(item => 
                item.keywords.some(keyword => lowerQuestion.includes(keyword))
            );

            return foundAnswer || null;
        }

        // Funkcija za prikaz kontakt forme
        function showContactForm(question) {
            const chatMessages = document.getElementById('chatMessages');
            if (!chatMessages) return;
            
            const contactForm = `
                <div class="contact-form">
                    <p>Nažalost, nisam siguran kako da vam pomognem sa pitanjem: "${question}"</p>
                    <p>Molimo popunite sledeći formular i naš tim će vam se javiti u najkraćem mogućem roku.</p>
                    <form id="supportForm">
                        <input type="hidden" name="question" value="${question}">
                        <div class="form-group">
                            <label for="name">Ime i prezime:</label>
                            <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email adresa:</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="message">Dodatne napomene (opciono):</label>
                            <textarea id="message" name="message" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Pošalji upit</button>
                    </form>
                </div>
            `;
            
            const formContainer = document.createElement('div');
            formContainer.innerHTML = contactForm;
            chatMessages.appendChild(formContainer);
            
            // Dodajemo event listener za formu
            const supportForm = document.getElementById('supportForm');
            if (supportForm) {
                supportForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Simuliramo slanje podataka
                    const response = document.createElement('div');
                    response.classList.add('message', 'bot-message');
                    response.innerHTML = 'Hvala vam na upitu! Naš tim će vam se javiti u najkraćem mogućem roku.';
                    chatMessages.appendChild(response);
                    
                    // Brišemo formu
                    formContainer.remove();
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                });
            }
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Glavna funkcija za slanje poruke
        function sendMessage(suggestedMessage) {
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            
            if (!chatMessages || !userInput) return;
            
            const messageText = suggestedMessage || userInput.value.trim();
            if (!messageText) return;
            
            // Dodajemo korisnikovu poruku u chat
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', 'user-message');
            messageElement.textContent = messageText;
            chatMessages.appendChild(messageElement);
            
            // Brišemo input samo ako nije predložena poruka (sugestija)
            if (!suggestedMessage) {
                userInput.value = '';
            }
            
            // Prikazujemo indikator kucanja
            const typingIndicator = document.createElement('div');
            typingIndicator.classList.add('message', 'bot-message', 'typing');
            typingIndicator.id = 'typingIndicator';
            typingIndicator.textContent = 'Pišem...';
            chatMessages.appendChild(typingIndicator);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simuliramo kašnjenje odgovora
            setTimeout(() => {
                // Uklanjamo indikator kucanja
                const indicator = document.getElementById('typingIndicator');
                if (indicator) {
                    indicator.remove();
                }

                // Proveravamo da li postoji odgovor u bazi znanja
                const answer = findAnswer(messageText);

                if (answer) {
                    // Ako postoji odgovor u bazi znanja, prikažemo ga
                    const responseElement = document.createElement('div');
                    responseElement.classList.add('message', 'bot-message');
                    responseElement.innerHTML = answer.response;
                    chatMessages.appendChild(responseElement);
                } else {
                    // Ako ne postoji odgovor, prikažemo kontakt formu
                    showContactForm(messageText);
                }

                // Skrolujemo na dno čata
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1500); // Simuliramo vreme potrebno za pisanje odgovora
        }
        
        // Inicijalizacija chat-a kada se stranica učita
        document.addEventListener('DOMContentLoaded', function() {
            // Inicijalizacija chat-a ako je potrebna
            console.log('Chat inicijalizovan');
        });
        
        // Funkcija za rukovanje slanjem forme za konsultacije
        function submitConsultationForm(event) {
            event.preventDefault();
            
            // Preuzimanje vrednosti iz forme
            const name = document.getElementById('clientName').value;
            const email = document.getElementById('clientEmail').value;
            const location = document.getElementById('location').value;
            const topic = document.getElementById('consultationTopic').value;
            const date = document.getElementById('consultationDate').value;
            const description = document.getElementById('description').value;
            
            // Validacija
            if (!name || !email || !location || !topic || !date || !description) {
                alert('Molimo popunite sva obavezna polja.');
                return;
            }
            
            // Ovde možete dodati logiku za slanje podataka na server
            console.log('Podaci za konsultacije:', { name, email, location, topic, date, description });
            
            // Prikazivanje poruke o uspehu
            document.getElementById('formSuccess').style.display = 'block';
            document.getElementById('formError').style.display = 'none';
            
            // Resetovanje forme
            document.getElementById('consultationForm').reset();
            
            // Zatvaranje modala nakon 3 sekunde
            setTimeout(() => {
                closeModal();
                document.getElementById('formSuccess').style.display = 'none';
            }, 3000);
        }
    </script>
    
    <!-- Consultation Modal -->
    <div id="consultationModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 style="color: #D4AF37; text-align: center; margin-bottom: 1.5rem;">Zakažite Konsultacije</h2>
            
            <form id="consultationForm" onsubmit="submitConsultationForm(event)">
                <div class="form-group">
                    <label for="clientName">Ime i prezime</label>
                    <input type="text" id="clientName" required 
                           style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px;" />
                </div>
                
                <div class="form-group">
                    <label for="clientEmail">Email adresa</label>
                    <input type="email" id="clientEmail" required
                           style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px;" />
                </div>
                
                <div class="form-group">
                    <label for="location">Mjesto i država</label>
                    <input type="text" id="location" required
                           style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px;" />
                </div>
                
                <div class="form-group">
                    <label for="consultationTopic">Tema konsultacije</label>
                    <select id="consultationTopic" required
                            style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px; background-color: #fff;">
                        <option value="">Izaberite temu</option>
                        <option value="Licne finansije">Lične finansije</option>
                        <option value="Investicije">Investicije</option>
                        <option value="Penziisko osiguranje">Penzijsko osiguranje</option>
                        <option value="Porezi">Porezi</option>
                        <option value="Ostalo">Ostalo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="consultationDate">Datum i vreme</label>
                    <input type="datetime-local" id="consultationDate" required
                           style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px;" />
                    <small style="color: #666; font-size: 0.8rem;">Dostupni termini: radnim danima između 09:00 i 17:00</small>
                </div>
                
                <div class="form-group">
                    <label for="description">Opis teme</label>
                    <textarea id="description" rows="4" required
                              style="width: 100%; padding: 0.75rem; border: 1px solid #D4AF37; border-radius: 4px;"></textarea>
                </div>
                
                <div id="formSuccess" style="display: none; color: #28a745; margin: 1rem 0; text-align: center;">
                    Uspešno ste zakazali konsultacije! Kontaktiraćemo vas u najkraćem roku.
                </div>
                
                <div id="formError" style="display: none; color: #dc3545; margin: 1rem 0; text-align: center;">
                </div>
                
                <button type="submit" class="primary-button" 
                        style="width: 100%; padding: 1rem; margin-top: 1rem;">
                    Zakaži konsultacije
                </button>
            </form>
        </div>
    </div>

    <script src="js/consultation.js"></script>
    <script>
        // Inicijalizacija modala i drugih skripti ako je potrebno
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Stranica je učitana');
        });
    </script>
</body>
</html>
)