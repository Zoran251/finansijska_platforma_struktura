<!-- Admin panel - Tab za notifikacije -->
<!-- Dodajte ovaj kod u admin_page.py -->

<!-- 1. Dodajte dugme za tab u navigaciji: -->
<button id="notificationsTabBtn" class="tab-button" style="margin-right: 1rem; background: transparent; color: var(--muted-text); border: none; font-weight: 600; padding: 0.5rem 1rem;">
    <i class="fas fa-bell" style="margin-right: 0.5rem;"></i>Notifikacije
</button>

<!-- 2. Dodajte sekciju za tab: -->
<div id="notificationsTab" class="admin-tab-content" style="display: none;">
    <div class="notifications-management">
        <h2 style="color: var(--gold-bright); margin-bottom: 1rem;">Upravljanje notifikacijama</h2>
        <p style="color: var(--muted-text); margin-bottom: 1.5rem;">
            Kreirajte i upravljajte notifikacijama koje će korisnici videti u svom notifikacionom centru.
        </p>
        
        <!-- Kontrole za upravljanje notifikacijama -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <div>
                <button id="createNotificationBtn" class="gold-button">
                    <i class="fas fa-plus" style="margin-right: 0.5rem;"></i>Nova notifikacija
                </button>
            </div>
            <div>
                <select id="notificationTypeFilter" style="padding: 0.5rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text);">
                    <option value="all">Sve notifikacije</option>
                    <option value="announcement">Obaveštenja</option>
                    <option value="meeting">Zakazani sastanci</option>
                    <option value="important">Važno</option>
                </select>
            </div>
        </div>
        
        <!-- Forma za kreiranje nove notifikacije -->
        <div id="notificationForm" style="background: var(--dark-card); border: 1px solid var(--border-light); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; display: none;">
            <h3 style="color: var(--gold-bright); margin-bottom: 1rem;">Nova notifikacija</h3>
            
            <div style="margin-bottom: 1rem;">
                <label for="notificationTitle" style="display: block; margin-bottom: 0.5rem; color: var(--gold-pale);">Naslov notifikacije</label>
                <input type="text" id="notificationTitle" placeholder="Unesite naslov notifikacije" 
                       style="width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text);">
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label for="notificationMessage" style="display: block; margin-bottom: 0.5rem; color: var(--gold-pale);">Poruka notifikacije</label>
                <textarea id="notificationMessage" placeholder="Unesite poruku notifikacije" 
                          style="width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text); min-height: 100px;"></textarea>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label for="notificationType" style="display: block; margin-bottom: 0.5rem; color: var(--gold-pale);">Tip notifikacije</label>
                <select id="notificationType" 
                        style="width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text);">
                    <option value="announcement">Obaveštenje</option>
                    <option value="meeting">Zakazani sastanak</option>
                    <option value="important">Važno</option>
                </select>
            </div>
            
            <div style="margin-bottom: 1rem;">
                <label for="notificationRecipients" style="display: block; margin-bottom: 0.5rem; color: var(--gold-pale);">Primaoci</label>
                <select id="notificationRecipients" 
                        style="width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text);">
                    <option value="all">Svi korisnici</option>
                    <option value="premium">Premium korisnici</option>
                    <option value="standard">Standardni korisnici</option>
                    <option value="individual">Pojedinačni korisnik</option>
                </select>
            </div>
            
            <div id="individualUserField" style="margin-bottom: 1rem; display: none;">
                <label for="notificationUserEmail" style="display: block; margin-bottom: 0.5rem; color: var(--gold-pale);">Email korisnika</label>
                <input type="email" id="notificationUserEmail" placeholder="Unesite email korisnika" 
                       style="width: 100%; padding: 0.75rem; background: rgba(31, 41, 55, 0.4); border: 1px solid var(--border-light); border-radius: 4px; color: var(--light-text);">
            </div>
            
            <div style="display: flex; justify-content: space-between;">
                <button id="cancelNotificationBtn" 
                        style="padding: 0.75rem 1.5rem; background: var(--dark-accent); color: var(--gold-pale); border: 1px solid var(--gold-dark); border-radius: 4px; cursor: pointer;">
                    Odustani
                </button>
                <button id="sendNotificationBtn" 
                        style="padding: 0.75rem 1.5rem; background: var(--gold-gradient); color: var(--dark-text); border: none; border-radius: 4px; cursor: pointer; font-weight: 600;">
                    Pošalji notifikaciju
                </button>
            </div>
        </div>
        
        <!-- Tabela sa postojećim notifikacijama -->
        <div class="notifications-table-container" style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">ID</th>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Datum</th>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Naslov</th>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Tip</th>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Primaoci</th>
                        <th style="text-align: left; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Status</th>
                        <th style="text-align: center; padding: 1rem; border-bottom: 2px solid var(--gold-dark); color: var(--gold-medium);">Akcije</th>
                    </tr>
                </thead>
                <tbody id="notificationsTableBody">
                    <!-- Notifikacije će biti dodate dinamički -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- 3. Dodajte JavaScript za aktiviranje taba: -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funkcija za prebacivanje između tabova
    function setupTabs() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.admin-tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.id.replace('Btn', '');
                
                // Uklanjanje aktivne klase sa svih tabova
                tabButtons.forEach(btn => {
                    btn.style.color = 'var(--muted-text)';
                    btn.style.borderBottom = 'none';
                });
                
                // Dodavanje aktivne klase na trenutni tab
                this.style.color = 'var(--gold-bright)';
                this.style.borderBottom = '2px solid var(--gold-bright)';
                
                // Sakrivanje svih sadržaja
                tabContents.forEach(content => {
                    content.style.display = 'none';
                });
                
                // Prikazivanje željenog sadržaja
                document.getElementById(tabId).style.display = 'block';
            });
        });
    }
    
    // Inicijalizacija tabova
    setupTabs();
    
    // Funkcionalnost za formu za notifikacije
    const createNotificationBtn = document.getElementById('createNotificationBtn');
    const cancelNotificationBtn = document.getElementById('cancelNotificationBtn');
    const sendNotificationBtn = document.getElementById('sendNotificationBtn');
    const notificationForm = document.getElementById('notificationForm');
    const notificationRecipients = document.getElementById('notificationRecipients');
    const individualUserField = document.getElementById('individualUserField');
    
    // Prikazivanje/sakrivanje forme
    if (createNotificationBtn) {
        createNotificationBtn.addEventListener('click', function() {
            notificationForm.style.display = 'block';
        });
    }
    
    if (cancelNotificationBtn) {
        cancelNotificationBtn.addEventListener('click', function() {
            notificationForm.style.display = 'none';
            // Resetovanje forme
            document.getElementById('notificationTitle').value = '';
            document.getElementById('notificationMessage').value = '';
            document.getElementById('notificationType').value = 'announcement';
            document.getElementById('notificationRecipients').value = 'all';
            document.getElementById('notificationUserEmail').value = '';
        });
    }
    
    // Prikazivanje/sakrivanje polja za email pojedinačnog korisnika
    if (notificationRecipients) {
        notificationRecipients.addEventListener('change', function() {
            individualUserField.style.display = this.value === 'individual' ? 'block' : 'none';
        });
    }
    
    // Slanje notifikacije
    if (sendNotificationBtn) {
        sendNotificationBtn.addEventListener('click', function() {
            const title = document.getElementById('notificationTitle').value;
            const message = document.getElementById('notificationMessage').value;
            const type = document.getElementById('notificationType').value;
            const recipients = document.getElementById('notificationRecipients').value;
            const userEmail = document.getElementById('notificationUserEmail').value;
            
            // Validacija
            if (!title || !message) {
                alert('Molimo unesite naslov i poruku notifikacije.');
                return;
            }
            
            if (recipients === 'individual' && !userEmail) {
                alert('Molimo unesite email korisnika.');
                return;
            }
            
            // Kreiranje notifikacije
            const notification = {
                title: title,
                message: message,
                type: type,
                recipients: recipients,
                userEmail: recipients === 'individual' ? userEmail : null
            };
            
            // Slanje notifikacije (implementirano u admin_notifications.js)
            if (typeof AdminNotifications !== 'undefined') {
                AdminNotifications.createNotification(notification);
                alert('Notifikacija je uspešno poslata!');
                notificationForm.style.display = 'none';
                
                // Resetovanje forme
                document.getElementById('notificationTitle').value = '';
                document.getElementById('notificationMessage').value = '';
                document.getElementById('notificationType').value = 'announcement';
                document.getElementById('notificationRecipients').value = 'all';
                document.getElementById('notificationUserEmail').value = '';
                
                // Osvežavanje tabele
                AdminNotifications.renderNotifications();
            } else {
                // Ako AdminNotifications nije definisan, koristimo alternativni pristup
                console.log('Šaljem notifikaciju:', notification);
                
                // Dodajemo notifikaciju u localStorage za demo
                const userNotifications = localStorage.getItem('userNotifications') ? 
                    JSON.parse(localStorage.getItem('userNotifications')) : [];
                
                userNotifications.push({
                    id: 'user_notif_' + Date.now(),
                    title: title,
                    message: message,
                    type: getTypeText(type),
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                localStorage.setItem('userNotifications', JSON.stringify(userNotifications));
                
                // Ažuriranje bedža
                updateNotificationBadge();
                
                alert('Notifikacija je uspešno poslata!');
                notificationForm.style.display = 'none';
            }
        });
    }
    
    // Pomoćna funkcija za pretvaranje tipa u tekstualni format
    function getTypeText(type) {
        switch(type) {
            case 'announcement': return 'Obaveštenje';
            case 'meeting': return 'Zakazani sastanak';
            case 'important': return 'Važno';
            default: return 'Obaveštenje';
        }
    }
    
    // Funkcija za ažuriranje bedža sa brojem nepročitanih notifikacija
    function updateNotificationBadge() {
        const userNotifications = localStorage.getItem('userNotifications') ? 
            JSON.parse(localStorage.getItem('userNotifications')) : [];
        
        const unreadCount = userNotifications.filter(notif => !notif.read).length;
        
        const badge = document.querySelector('.notification-badge');
        if (badge) {
            badge.textContent = unreadCount;
            badge.style.display = unreadCount > 0 ? 'flex' : 'none';
        }
    }
});
</script>
